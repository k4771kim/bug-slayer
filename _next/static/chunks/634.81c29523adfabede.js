"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[634],{6634:(t,e,s)=>{s.r(e),s.d(e,{PhaserGame:()=>Q});var i=s(9867),a=s(8523),r=s(3776),n=s.n(r);class l{static generateCharacterSprite(t,e){let s=document.createElement("canvas");s.width=32,s.height=32;let i=s.getContext("2d",{willReadFrequently:!1});if(!i)throw Error("Failed to get canvas context");switch(i.imageSmoothingEnabled=!1,t.toLowerCase()){case"debugger":default:this.drawDebuggerSprite(i,e);break;case"refactorer":this.drawRefactorerSprite(i,e);break;case"fullstack":this.drawFullStackSprite(i,e);break;case"devops":this.drawDevOpsSprite(i,e)}return s}static generateIconSprite(t,e){let s=document.createElement("canvas");s.width=16,s.height=16;let i=s.getContext("2d",{willReadFrequently:!1});if(!i)throw Error("Failed to get canvas context");switch(i.imageSmoothingEnabled=!1,t.toLowerCase()){case"sword":case"attack":default:this.drawSwordIcon(i,e);break;case"star":case"skill":this.drawStarIcon(i,e);break;case"shield":case"focus":case"defense":this.drawShieldIcon(i,e);break;case"potion":case"item":this.drawPotionIcon(i,e);break;case"run":case"flee":this.drawRunIcon(i,e)}return s}static generateMonsterSprite(t,e){let s=document.createElement("canvas");s.width=32,s.height=32;let i=s.getContext("2d",{willReadFrequently:!1});if(!i)throw Error("Failed to get canvas context");i.imageSmoothingEnabled=!1;let a=t.toLowerCase();return a.includes("boss")||a.includes("heisenbug")||a.includes("finalcompiler")?this.drawBossSprite(i,e):this.drawBugSprite(i,e),s}static paletteSwap(t,e,s){let i=document.createElement("canvas");i.width=t.width,i.height=t.height;let a=i.getContext("2d",{willReadFrequently:!0});if(!a)throw Error("Failed to get canvas context");a.imageSmoothingEnabled=!1,a.drawImage(t,0,0);let r=a.getImageData(0,0,i.width,i.height),n=r.data,l=e.map(t=>this.hexToRgb(t)),o=s.map(t=>this.hexToRgb(t));for(let t=0;t<n.length;t+=4){let e=n[t],s=n[t+1],i=n[t+2];for(let a=0;a<l.length;a++){let r=l[a],c=o[a];if(r&&c&&e===r.r&&s===r.g&&i===r.b){n[t]=c.r,n[t+1]=c.g,n[t+2]=c.b;break}}}return a.putImageData(r,0,0),i}static upscale(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,s=document.createElement("canvas");s.width=t.width*e,s.height=t.height*e;let i=s.getContext("2d",{willReadFrequently:!1});if(!i)throw Error("Failed to get canvas context");return i.imageSmoothingEnabled=!1,i.drawImage(t,0,0,s.width,s.height),s}static drawDebuggerSprite(t,e){t.fillStyle=e.primary,this.fillPixels(t,[[14,6],[15,6],[16,6],[17,6]]),this.fillPixels(t,[[13,7],[14,7],[15,7],[16,7],[17,7],[18,7]]),this.fillPixels(t,[[12,8],[13,8],[18,8],[19,8]]),this.fillPixels(t,[[12,9],[19,9]]),t.fillStyle="#d4c5b9",this.fillPixels(t,[[14,8],[15,8],[16,8],[17,8]]),this.fillPixels(t,[[13,9],[14,9],[15,9],[16,9],[17,9],[18,9]]),this.fillPixels(t,[[14,10],[15,10],[16,10],[17,10]]),t.fillStyle="#333333",this.fillPixels(t,[[14,9],[17,9]]),t.fillStyle=e.secondary,this.fillPixels(t,[[13,11],[14,11],[15,11],[16,11],[17,11],[18,11]]),this.fillPixels(t,[[12,12],[13,12],[14,12],[15,12],[16,12],[17,12],[18,12],[19,12]]),this.fillPixels(t,[[12,13],[13,13],[18,13],[19,13]]),this.fillPixels(t,[[12,14],[13,14],[18,14],[19,14]]),this.fillPixels(t,[[12,15],[13,15],[18,15],[19,15]]),this.fillPixels(t,[[14,13],[15,13],[16,13],[17,13]]),this.fillPixels(t,[[14,14],[15,14],[16,14],[17,14]]),this.fillPixels(t,[[14,15],[15,15],[16,15],[17,15]]),this.fillPixels(t,[[13,16],[14,16],[17,16],[18,16]]),this.fillPixels(t,[[13,17],[14,17],[17,17],[18,17]]),this.fillPixels(t,[[13,18],[14,18],[17,18],[18,18]]),t.fillStyle=e.accent,this.fillPixels(t,[[20,13],[21,14],[22,15]]),t.fillStyle="#88ccff",this.fillPixels(t,[[23,14],[24,14]]),this.fillPixels(t,[[22,15],[23,15],[24,15],[25,15]]),this.fillPixels(t,[[23,16],[24,16]])}static drawRefactorerSprite(t,e){t.fillStyle="#666666",this.fillPixels(t,[[13,7],[14,7],[17,7],[18,7]]),this.fillPixels(t,[[13,8],[14,8],[17,8],[18,8]]),t.fillStyle="#88ccff",this.fillPixels(t,[[14,8],[17,8]]),t.fillStyle="#d4c5b9",this.fillPixels(t,[[14,9],[15,9],[16,9],[17,9]]),this.fillPixels(t,[[13,10],[14,10],[15,10],[16,10],[17,10],[18,10]]),t.fillStyle="#333333",this.fillPixels(t,[[14,9],[17,9]]),t.fillStyle=e.primary,this.fillPixels(t,[[13,11],[14,11],[15,11],[16,11],[17,11],[18,11]]),this.fillPixels(t,[[12,12],[13,12],[14,12],[15,12],[16,12],[17,12],[18,12],[19,12]]),this.fillPixels(t,[[12,13],[13,13],[14,13],[15,13],[16,13],[17,13],[18,13],[19,13]]),this.fillPixels(t,[[12,14],[13,14],[18,14],[19,14]]),this.fillPixels(t,[[12,15],[13,15],[18,15],[19,15]]),t.fillStyle=e.secondary,this.fillPixels(t,[[13,15],[14,15],[15,15],[16,15],[17,15],[18,15]]),t.fillStyle="#555555",this.fillPixels(t,[[13,16],[14,16],[17,16],[18,16]]),this.fillPixels(t,[[13,17],[14,17],[17,17],[18,17]]),this.fillPixels(t,[[13,18],[14,18],[17,18],[18,18]]),t.fillStyle=e.accent,this.fillPixels(t,[[20,12],[21,13],[22,14]]),this.fillPixels(t,[[22,13],[23,13],[23,14],[24,14]])}static drawFullStackSprite(t,e){t.fillStyle=e.primary,this.fillPixels(t,[[14,5],[15,5],[16,5],[17,5]]),this.fillPixels(t,[[13,6],[14,6],[15,6],[16,6],[17,6],[18,6]]),this.fillPixels(t,[[12,7],[13,7],[18,7],[19,7]]),t.fillStyle="#d4c5b9",this.fillPixels(t,[[14,7],[15,7],[16,7],[17,7]]),this.fillPixels(t,[[14,8],[15,8],[16,8],[17,8]]),this.fillPixels(t,[[13,9],[14,9],[15,9],[16,9],[17,9],[18,9]]),t.fillStyle="#333333",this.fillPixels(t,[[14,8],[17,8]]),t.fillStyle=e.secondary,this.fillPixels(t,[[13,10],[14,10],[15,10],[16,10],[17,10],[18,10]]),this.fillPixels(t,[[12,11],[13,11],[14,11],[15,11],[16,11],[17,11],[18,11],[19,11]]),this.fillPixels(t,[[11,12],[12,12],[13,12],[14,12],[15,12],[16,12],[17,12],[18,12],[19,12],[20,12]]),this.fillPixels(t,[[11,13],[12,13],[13,13],[18,13],[19,13],[20,13]]),this.fillPixels(t,[[11,14],[12,14],[19,14],[20,14]]),this.fillPixels(t,[[11,15],[12,15],[19,15],[20,15]]),t.fillStyle=e.accent,this.fillPixels(t,[[10,13],[9,14],[10,15]]),this.fillPixels(t,[[21,13],[22,14],[21,15]]),t.fillStyle=e.primary,this.fillPixels(t,[[13,16],[14,16],[17,16],[18,16]]),this.fillPixels(t,[[13,17],[14,17],[17,17],[18,17]]),this.fillPixels(t,[[13,18],[14,18],[17,18],[18,18]])}static drawDevOpsSprite(t,e){t.fillStyle=e.primary,this.fillPixels(t,[[13,6],[14,6],[15,6],[16,6],[17,6],[18,6]]),this.fillPixels(t,[[12,7],[13,7],[14,7],[15,7],[16,7],[17,7],[18,7],[19,7]]),this.fillPixels(t,[[12,8],[19,8]]),t.fillStyle="#88ccff",this.fillPixels(t,[[13,8],[14,8],[15,8],[16,8],[17,8],[18,8]]),t.fillStyle="#333333",this.fillPixels(t,[[14,8],[17,8]]),t.fillStyle="#d4c5b9",this.fillPixels(t,[[14,9],[15,9],[16,9],[17,9]]),t.fillStyle=e.secondary,this.fillPixels(t,[[13,10],[14,10],[15,10],[16,10],[17,10],[18,10]]),this.fillPixels(t,[[12,11],[13,11],[14,11],[15,11],[16,11],[17,11],[18,11],[19,11]]),this.fillPixels(t,[[12,12],[13,12],[14,12],[15,12],[16,12],[17,12],[18,12],[19,12]]),this.fillPixels(t,[[12,13],[13,13],[18,13],[19,13]]),this.fillPixels(t,[[12,14],[13,14],[18,14],[19,14]]),this.fillPixels(t,[[12,15],[13,15],[18,15],[19,15]]),t.fillStyle=e.accent,this.fillPixels(t,[[15,12],[16,12]]),this.fillPixels(t,[[14,13],[15,13],[16,13],[17,13]]),this.fillPixels(t,[[15,14],[16,14]]),t.fillStyle=e.primary,this.fillPixels(t,[[13,16],[14,16],[17,16],[18,16]]),this.fillPixels(t,[[13,17],[14,17],[17,17],[18,17]]),this.fillPixels(t,[[13,18],[14,18],[17,18],[18,18]]),t.fillStyle="#cccccc",this.fillPixels(t,[[10,11],[10,12],[10,13],[10,14]]),this.fillPixels(t,[[9,12],[9,13]])}static drawBugSprite(t,e){t.fillStyle=e,this.fillPixels(t,[[13,8],[12,7],[11,6]]),this.fillPixels(t,[[18,8],[19,7],[20,6]]),this.fillPixels(t,[[14,9],[15,9],[16,9],[17,9]]),this.fillPixels(t,[[13,10],[14,10],[15,10],[16,10],[17,10],[18,10]]),t.fillStyle=this.darkenColor(e,.5),this.fillPixels(t,[[14,10],[17,10]]),t.fillStyle=e,this.fillPixels(t,[[12,11],[13,11],[14,11],[15,11],[16,11],[17,11],[18,11],[19,11]]),this.fillPixels(t,[[11,12],[12,12],[13,12],[14,12],[15,12],[16,12],[17,12],[18,12],[19,12],[20,12]]),this.fillPixels(t,[[11,13],[12,13],[13,13],[14,13],[15,13],[16,13],[17,13],[18,13],[19,13],[20,13]]),this.fillPixels(t,[[12,14],[13,14],[14,14],[15,14],[16,14],[17,14],[18,14],[19,14]]),this.fillPixels(t,[[13,15],[14,15],[15,15],[16,15],[17,15],[18,15]]),t.fillStyle=this.darkenColor(e,.3),this.fillPixels(t,[[11,12],[20,12]]),this.fillPixels(t,[[12,14],[19,14]]),t.fillStyle=this.darkenColor(e,.4),this.fillPixels(t,[[10,12],[9,13],[8,14]]),this.fillPixels(t,[[10,13],[9,14],[8,15]]),this.fillPixels(t,[[11,14],[10,15],[9,16]]),this.fillPixels(t,[[21,12],[22,13],[23,14]]),this.fillPixels(t,[[21,13],[22,14],[23,15]]),this.fillPixels(t,[[20,14],[21,15],[22,16]])}static drawBossSprite(t,e){t.fillStyle="#ffcc00",this.fillPixels(t,[[12,5],[13,4],[14,5]]),this.fillPixels(t,[[15,3],[16,3]]),this.fillPixels(t,[[17,5],[18,4],[19,5]]),t.fillStyle=e,this.fillPixels(t,[[13,7],[14,7],[15,7],[16,7],[17,7],[18,7]]),this.fillPixels(t,[[12,8],[13,8],[14,8],[15,8],[16,8],[17,8],[18,8],[19,8]]),this.fillPixels(t,[[11,9],[12,9],[13,9],[14,9],[15,9],[16,9],[17,9],[18,9],[19,9],[20,9]]),t.fillStyle="#ff0000",this.fillPixels(t,[[13,8],[14,8]]),this.fillPixels(t,[[17,8],[18,8]]),t.fillStyle=e,this.fillPixels(t,[[10,10],[11,10],[12,10],[13,10],[14,10],[15,10],[16,10],[17,10],[18,10],[19,10],[20,10],[21,10]]),this.fillPixels(t,[[9,11],[10,11],[11,11],[12,11],[13,11],[14,11],[15,11],[16,11],[17,11],[18,11],[19,11],[20,11],[21,11],[22,11]]),this.fillPixels(t,[[9,12],[10,12],[11,12],[12,12],[13,12],[14,12],[15,12],[16,12],[17,12],[18,12],[19,12],[20,12],[21,12],[22,12]]),this.fillPixels(t,[[10,13],[11,13],[12,13],[13,13],[14,13],[15,13],[16,13],[17,13],[18,13],[19,13],[20,13],[21,13]]),this.fillPixels(t,[[11,14],[12,14],[13,14],[14,14],[15,14],[16,14],[17,14],[18,14],[19,14],[20,14]]),this.fillPixels(t,[[12,15],[13,15],[14,15],[15,15],[16,15],[17,15],[18,15],[19,15]]),t.fillStyle=this.darkenColor(e,.3),this.fillPixels(t,[[9,11],[22,11]]),this.fillPixels(t,[[10,13],[21,13]]),this.fillPixels(t,[[12,15],[19,15]]),t.fillStyle=this.lightenColor(e,.3),this.fillPixels(t,[[8,10],[23,10]]),this.fillPixels(t,[[8,11],[23,11]]),this.fillPixels(t,[[8,12],[23,12]])}static drawSwordIcon(t,e){t.fillStyle=e,this.fillPixels(t,[[11,2],[10,3],[9,4],[8,5],[7,6],[6,7]]),this.fillPixels(t,[[12,2],[11,3],[10,4],[9,5],[8,6],[7,7]]),t.fillStyle="#cccccc",this.fillPixels(t,[[5,8],[6,8],[7,8],[8,8]]),t.fillStyle="#8b4513",this.fillPixels(t,[[6,9],[6,10],[6,11]]),t.fillStyle="#ffd700",this.fillPixels(t,[[5,12],[6,12],[7,12]])}static drawStarIcon(t,e){t.fillStyle=e,this.fillPixels(t,[[7,7],[8,7],[7,8],[8,8]]),this.fillPixels(t,[[7,5],[8,5],[7,6],[8,6]]),this.fillPixels(t,[[7,9],[8,9],[7,10],[8,10]]),this.fillPixels(t,[[5,7],[6,7],[5,8],[6,8]]),this.fillPixels(t,[[9,7],[10,7],[9,8],[10,8]]),this.fillPixels(t,[[6,6],[9,6],[6,9],[9,9]])}static drawShieldIcon(t,e){t.fillStyle=e,this.fillPixels(t,[[7,3],[8,3]]),this.fillPixels(t,[[6,4],[7,4],[8,4],[9,4]]),this.fillPixels(t,[[5,5],[6,5],[7,5],[8,5],[9,5],[10,5]]),this.fillPixels(t,[[5,6],[6,6],[7,6],[8,6],[9,6],[10,6]]),this.fillPixels(t,[[5,7],[6,7],[7,7],[8,7],[9,7],[10,7]]),this.fillPixels(t,[[5,8],[6,8],[7,8],[8,8],[9,8],[10,8]]),this.fillPixels(t,[[6,9],[7,9],[8,9],[9,9]]),this.fillPixels(t,[[6,10],[7,10],[8,10],[9,10]]),this.fillPixels(t,[[7,11],[8,11]]),this.fillPixels(t,[[7,12],[8,12]]),t.fillStyle=this.darkenColor(e,.3),this.fillPixels(t,[[7,5],[8,5]]),this.fillPixels(t,[[7,6],[8,6]]),this.fillPixels(t,[[7,7],[8,7]]),this.fillPixels(t,[[7,8],[8,8]])}static drawPotionIcon(t,e){t.fillStyle="#888888",this.fillPixels(t,[[7,4],[8,4]]),this.fillPixels(t,[[7,5],[8,5]]),t.fillStyle="#8b4513",this.fillPixels(t,[[6,3],[7,3],[8,3],[9,3]]),t.fillStyle="#aaaaaa",this.fillPixels(t,[[6,6],[7,6],[8,6],[9,6]]),this.fillPixels(t,[[5,7],[6,7],[7,7],[8,7],[9,7],[10,7]]),this.fillPixels(t,[[5,8],[6,8],[7,8],[8,8],[9,8],[10,8]]),this.fillPixels(t,[[5,9],[6,9],[7,9],[8,9],[9,9],[10,9]]),this.fillPixels(t,[[5,10],[6,10],[7,10],[8,10],[9,10],[10,10]]),this.fillPixels(t,[[6,11],[7,11],[8,11],[9,11]]),t.fillStyle=e,this.fillPixels(t,[[6,8],[7,8],[8,8],[9,8]]),this.fillPixels(t,[[6,9],[7,9],[8,9],[9,9]]),this.fillPixels(t,[[6,10],[7,10],[8,10],[9,10]])}static drawRunIcon(t,e){t.fillStyle=e,this.fillPixels(t,[[8,4],[9,4],[8,5],[9,5]]),this.fillPixels(t,[[8,6],[9,6],[8,7],[9,7],[8,8],[9,8]]),this.fillPixels(t,[[7,9],[8,9],[6,10],[7,10]]),this.fillPixels(t,[[10,9],[11,9],[11,10],[12,10]]),this.fillPixels(t,[[6,6],[7,6],[10,7],[11,7]]),t.fillStyle=this.lightenColor(e,.5),this.fillPixels(t,[[3,5],[4,5],[5,5]]),this.fillPixels(t,[[2,7],[3,7],[4,7]]),this.fillPixels(t,[[3,9],[4,9],[5,9]])}static fillPixels(t,e){for(let s of e){let e=s[0],i=s[1];void 0!==e&&void 0!==i&&t.fillRect(e,i,1,1)}}static hexToRgb(t){let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e&&e[1]&&e[2]&&e[3]?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}static darkenColor(t,e){let s=this.hexToRgb(t);if(!s)return t;let i=Math.floor(s.r*(1-e)),a=Math.floor(s.g*(1-e)),r=Math.floor(s.b*(1-e));return"#".concat(i.toString(16).padStart(2,"0")).concat(a.toString(16).padStart(2,"0")).concat(r.toString(16).padStart(2,"0"))}static lightenColor(t,e){let s=this.hexToRgb(t);if(!s)return t;let i=Math.min(255,Math.floor(s.r+(255-s.r)*e)),a=Math.min(255,Math.floor(s.g+(255-s.g)*e)),r=Math.min(255,Math.floor(s.b+(255-s.b)*e));return"#".concat(i.toString(16).padStart(2,"0")).concat(a.toString(16).padStart(2,"0")).concat(r.toString(16).padStart(2,"0"))}}let o=JSON.parse('{"gT":{"debugger":"#569cd6","refactorer":"#4ec9b0","fullstack":"#c586c0","devops":"#dcdcaa"},"t4":{"nullpointer":"#f48771","stackoverflow":"#ce9178","racecondition":"#cca700","memoryleak":"#89d185","deadlock":"#858585","offbyone":"#d16969","sqlinjection":"#c586c0","xss":"#ce9178","bufferoverflow":"#f48771","infiniteloop":"#dcdcaa","heisenbug":"#c678dd"}}');class c extends n().Scene{preload(){let t=this.cameras.main.width,e=this.cameras.main.height,s=this.add.text(t/2,e/2,"Loading...",{fontSize:"24px",color:"#ffffff"});s.setOrigin(.5,.5);let i=this.add.graphics(),a=this.add.graphics();a.fillStyle(2236962,.8),a.fillRect(t/2-160,e/2+50,320,30),this.load.on("progress",s=>{i.clear(),i.fillStyle(4886754,1),i.fillRect(t/2-150,e/2+60,300*s,10)}),this.load.on("complete",()=>{i.destroy(),a.destroy(),s.destroy()})}create(){console.log("BootScene: Generating procedural sprites..."),this.generateCharacterSprites(),this.generateMonsterSprites(),this.generateIconSprites(),console.log("BootScene: Assets loaded, transitioning to MainMenuScene"),this.scene.start("MainMenuScene")}generateCharacterSprites(){let t=o.gT;for(let e of["debugger","refactorer","fullstack","devops"]){let s=t[e];if(!s){console.warn("No color found for class: ".concat(e));continue}let i={primary:s,secondary:this.darkenColor(s,.2),accent:this.lightenColor(s,.3)},a=l.generateCharacterSprite(e,i),r=l.upscale(a,2);this.textures.addCanvas("character-".concat(e),r),console.log("Generated sprite: character-".concat(e))}}generateMonsterSprites(){for(let[t,e]of Object.entries(o.t4)){let s=l.generateMonsterSprite(t,e),i=l.upscale(s,2);this.textures.addCanvas("bug-".concat(t),i),console.log("Generated sprite: bug-".concat(t))}let t=l.generateMonsterSprite("boss-generic","#c678dd"),e=l.upscale(t,2);this.textures.addCanvas("bug-boss-generic",e),console.log("Generated sprite: bug-boss-generic")}generateIconSprites(){for(let t of[{name:"sword",type:"attack",color:"#f48771"},{name:"star",type:"skill",color:"#569cd6"},{name:"shield",type:"focus",color:"#dcdcaa"},{name:"potion",type:"item",color:"#4ec9b0"},{name:"run",type:"flee",color:"#858585"}]){let e=l.generateIconSprite(t.type,t.color),s=l.upscale(e,2);this.textures.addCanvas("icon-".concat(t.name),s),console.log("Generated icon: icon-".concat(t.name))}}darkenColor(t,e){let s=this.hexToRgb(t);if(!s)return t;let i=Math.floor(s.r*(1-e)),a=Math.floor(s.g*(1-e)),r=Math.floor(s.b*(1-e));return"#".concat(i.toString(16).padStart(2,"0")).concat(a.toString(16).padStart(2,"0")).concat(r.toString(16).padStart(2,"0"))}lightenColor(t,e){let s=this.hexToRgb(t);if(!s)return t;let i=Math.min(255,Math.floor(s.r+(255-s.r)*e)),a=Math.min(255,Math.floor(s.g+(255-s.g)*e)),r=Math.min(255,Math.floor(s.b+(255-s.b)*e));return"#".concat(i.toString(16).padStart(2,"0")).concat(a.toString(16).padStart(2,"0")).concat(r.toString(16).padStart(2,"0"))}hexToRgb(t){let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e&&e[1]&&e[2]&&e[3]?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}constructor(){super({key:"BootScene"})}}class h{initializeProgress(){return{currentChapter:1,currentStage:1,chapters:new Map([[1,{chapter:1,unlocked:!0,completed:!1,stagesCompleted:0,totalStages:6,bossDefeated:!1}],[2,{chapter:2,unlocked:!1,completed:!1,stagesCompleted:0,totalStages:5,bossDefeated:!1}]]),stages:[],totalDefeated:0,totalTechDebt:0,playTime:0,lastPlayed:new Date}}getCurrentChapter(){return this.progress.currentChapter}getCurrentStage(){return this.progress.currentStage}isChapterUnlocked(t){var e,s;return null!=(s=null==(e=this.progress.chapters.get(t))?void 0:e.unlocked)&&s}isStageUnlocked(t,e){let s=this.progress.chapters.get(t);return!!s&&!!s.unlocked&&(1===e||s.stagesCompleted>=e-1)}completeStage(t,e){var s;let i=this.progress.currentChapter,a=this.progress.currentStage,r={chapter:i,stage:a,completed:!0,attempts:1,bestTime:e,techDebt:t},n=this.progress.stages.findIndex(t=>t.chapter===i&&t.stage===a);n>=0?this.progress.stages[n]=r:this.progress.stages.push(r);let l=this.progress.chapters.get(i);l&&(l.stagesCompleted=Math.max(l.stagesCompleted,a),a===this.CHAPTER_CONFIG[i].totalStages&&(l.bossDefeated=!0,l.completed=!0)),this.progress.totalDefeated+=1,this.progress.totalTechDebt=Math.max(0,this.progress.totalTechDebt+t);let o=null!=(s=null==l?void 0:l.completed)&&s,c=!1;if(o&&1===i){let t=this.progress.chapters.get(2);t&&!t.unlocked&&(t.unlocked=!0,c=!0)}return this.advanceStage(),{chapterCompleted:o,newChapterUnlocked:c}}advanceStage(){let t=this.progress.currentChapter,e=this.CHAPTER_CONFIG[t];this.progress.currentStage>=e.totalStages?1===t&&this.isChapterUnlocked(2)&&(this.progress.currentChapter=2,this.progress.currentStage=1):this.progress.currentStage+=1}getChapterProgress(t){var e;return null!=(e=this.progress.chapters.get(t))?e:null}getUnlockedChapters(){return Array.from(this.progress.chapters.entries()).filter(t=>{let[e,s]=t;return s.unlocked}).map(t=>{let[e,s]=t;return e})}getStageProgress(t,e){var s;return null!=(s=this.progress.stages.find(s=>s.chapter===t&&s.stage===e))?s:null}getTotalTechDebt(){return this.progress.totalTechDebt}getTotalDefeated(){return this.progress.totalDefeated}getPlayTime(){return this.progress.playTime}addPlayTime(t){this.progress.playTime+=t}resetProgress(){this.progress=this.initializeProgress()}saveProgress(){try{let t={version:this.SAVE_VERSION,timestamp:new Date().toISOString(),progress:{currentChapter:this.progress.currentChapter,currentStage:this.progress.currentStage,chapters:Array.from(this.progress.chapters.entries()).map(t=>{let[e,s]=t;return{chapter:e,data:s}}),stages:this.progress.stages,totalDefeated:this.progress.totalDefeated,totalTechDebt:this.progress.totalTechDebt,playTime:this.progress.playTime}};return localStorage.setItem(this.SAVE_KEY,JSON.stringify(t)),!0}catch(t){return console.error("Failed to save progress:",t),!1}}loadProgress(t){try{let e;if(t)e=t;else{let t=localStorage.getItem(this.SAVE_KEY);if(!t)return!1;e=JSON.parse(t)}if(e.version!==this.SAVE_VERSION)return console.warn("Save version mismatch, skipping load"),!1;return this.progress.currentChapter=e.progress.currentChapter,this.progress.currentStage=e.progress.currentStage,this.progress.totalDefeated=e.progress.totalDefeated,this.progress.totalTechDebt=e.progress.totalTechDebt,this.progress.playTime=e.progress.playTime,this.progress.stages=e.progress.stages,this.progress.chapters.clear(),e.progress.chapters.forEach(t=>{let{chapter:e,data:s}=t;this.progress.chapters.set(e,s)}),this.progress.lastPlayed=new Date(e.timestamp),!0}catch(t){return console.error("Failed to load progress:",t),!1}}static loadSave(){try{let t=localStorage.getItem("bug-slayer-progress");if(!t)return null;return JSON.parse(t)}catch(t){return console.error("Failed to load save:",t),null}}hasSaveData(){return null!==localStorage.getItem(this.SAVE_KEY)}deleteSaveData(){try{return localStorage.removeItem(this.SAVE_KEY),!0}catch(t){return console.error("Failed to delete save data:",t),!1}}getCompletionPercentage(){let t=0,e=0;return this.progress.chapters.forEach(s=>{t+=s.totalStages,e+=s.stagesCompleted}),t>0?Math.round(e/t*100):0}getSummary(){let t=this.progress.currentChapter,e=this.progress.currentStage,s=Math.floor(this.progress.playTime/3600),i=Math.floor(this.progress.playTime%3600/60);return{currentLocation:"Chapter ".concat(t," - Stage ").concat(e),completion:this.getCompletionPercentage(),techDebt:this.progress.totalTechDebt,defeated:this.progress.totalDefeated,playTime:s>0?"".concat(s,"h ").concat(i,"m"):"".concat(i,"m")}}constructor(){this.SAVE_KEY="bug-slayer-progress",this.SAVE_VERSION="1.0.0",this.CHAPTER_CONFIG={1:{totalStages:6,bugs:5,boss:1},2:{totalStages:5,bugs:4,boss:1}},this.progress=this.initializeProgress()}}class d extends n().Scene{create(){let t=this.cameras.main.width,e=this.cameras.main.height;this.add.rectangle(t/2,e/2,t,e,1973790),this.add.text(t/2,120,"Bug Slayer:",{fontSize:"48px",color:"#4a90e2",fontStyle:"bold",stroke:"#2a5a8a",strokeThickness:2}).setOrigin(.5),this.add.text(t/2,170,"The Debugging Dungeon",{fontSize:"28px",color:"#569cd6",fontStyle:"italic"}).setOrigin(.5);let s=t=>({fontSize:"20px",color:"#ffffff",backgroundColor:t,padding:{x:30,y:12}}),i=this.add.text(t/2,280,"New Game",s("#4a90e2")).setOrigin(.5).setInteractive();i.on("pointerover",()=>i.setBackgroundColor("#5aa0f2")),i.on("pointerout",()=>i.setBackgroundColor("#4a90e2")),i.on("pointerdown",()=>this.startNewGame());let a=this.add.text(t/2,350,"Continue",s("#4ade80")).setOrigin(.5).setInteractive();a.on("pointerover",()=>a.setBackgroundColor("#5aee90")),a.on("pointerout",()=>a.setBackgroundColor("#4ade80")),a.on("pointerdown",()=>this.loadSavedGame());let r=this.add.text(t/2,420,"Credits",s("#c586c0")).setOrigin(.5).setInteractive();r.on("pointerover",()=>r.setBackgroundColor("#d596d0")),r.on("pointerout",()=>r.setBackgroundColor("#c586c0")),r.on("pointerdown",()=>this.showCredits()),this.add.text(t/2,e-30,"v1.0.0 MVP",{fontSize:"14px",color:"#858585"}).setOrigin(.5)}startNewGame(){this.scene.start("ClassSelectScene")}loadSavedGame(){try{var t,e;let s=h.loadSave();if(!s)return void this.showNoSaveMessage();let i=new h;i.loadProgress(s),this.scene.start("DungeonSelectScene",{playerClass:s.playerClass,player:s.player,techDebt:s.techDebt,progression:i,stagesCompleted:null!=(t=s.stagesCompleted)?t:[],playTime:null!=(e=s.playTime)?e:0})}catch(t){console.error("Failed to load save:",t),this.showNoSaveMessage()}}showNoSaveMessage(){let t=this.cameras.main.width,e=this.cameras.main.height,s=this.add.container(t/2,e/2),i=this.add.rectangle(0,0,400,150,1710638,.95);i.setStrokeStyle(2,0xef4444),s.add(i);let a=this.add.text(0,-20,"No save data found!",{fontSize:"20px",color:"#ef4444",fontStyle:"bold"}).setOrigin(.5);s.add(a);let r=this.add.text(0,20,"Start a New Game to begin.",{fontSize:"14px",color:"#858585"}).setOrigin(.5);s.add(r),this.time.delayedCall(2e3,()=>{s.destroy()})}showCredits(){if(this.creditsOverlay)return;let t=this.cameras.main.width,e=this.cameras.main.height;this.creditsOverlay=this.add.container(t/2,e/2);let s=this.add.rectangle(0,0,500,300,1710638,.95);s.setStrokeStyle(2,0xc586c0),this.creditsOverlay.add(s);let i=this.add.text(0,-100,"Credits",{fontSize:"28px",color:"#c586c0",fontStyle:"bold"}).setOrigin(.5);this.creditsOverlay.add(i);let a=this.add.text(0,-20,"Created by AI Chat Lounge Team\n\nGame Design: 루미PM\nDevelopment: AI Agents\nProject: Bug Slayer MVP\n\nBuilt with Phaser 3 + TypeScript",{fontSize:"16px",color:"#ffffff",align:"center",lineSpacing:8}).setOrigin(.5);this.creditsOverlay.add(a);let r=this.add.text(0,110,"Close",{fontSize:"18px",color:"#ffffff",backgroundColor:"#4a90e2",padding:{x:20,y:8}}).setOrigin(.5).setInteractive();r.on("pointerover",()=>r.setBackgroundColor("#5aa0f2")),r.on("pointerout",()=>r.setBackgroundColor("#4a90e2")),r.on("pointerdown",()=>this.hideCredits()),this.creditsOverlay.add(r)}hideCredits(){this.creditsOverlay&&(this.creditsOverlay.destroy(),this.creditsOverlay=null)}constructor(){super({key:"MainMenuScene"}),this.creditsOverlay=null}}let u=JSON.parse('{"L":[{"id":"debugger","name":"Debugger","description":"High HP and defensive capabilities. Perfect for beginners who want a forgiving playstyle.","baseStats":{"HP":120,"ATK":12,"DEF":10,"SPD":8,"MP":40},"statGrowth":{"HP":8,"ATK":2,"DEF":2,"SPD":1,"MP":3},"skillIds":["debugger-basic-attack","debugger-breakpoint","debugger-stack-trace","debugger-watch-variable","debugger-defensive-stance","debugger-error-handler","debugger-step-through","debugger-assert"],"passive":{"name":"Exception Handler","description":"20% chance to reduce incoming damage by 50%"}},{"id":"refactorer","name":"Refactorer","description":"Balanced stats with versatile skills. Can adapt to any situation.","baseStats":{"HP":100,"ATK":14,"DEF":8,"SPD":10,"MP":50},"statGrowth":{"HP":6,"ATK":2,"DEF":1,"SPD":2,"MP":4},"skillIds":["refactorer-basic-attack","refactorer-clean-code","refactorer-extract-method","refactorer-optimize","refactorer-rename","refactorer-inline","refactorer-pattern-apply","refactorer-technical-debt"],"passive":{"name":"Code Optimization","description":"Every 3rd attack deals 150% damage"}},{"id":"fullstack","name":"FullStack","description":"High damage output with powerful offensive skills. Glass cannon playstyle.","baseStats":{"HP":90,"ATK":18,"DEF":6,"SPD":9,"MP":60},"statGrowth":{"HP":5,"ATK":3,"DEF":1,"SPD":1,"MP":5},"skillIds":["fullstack-basic-attack","fullstack-api-call","fullstack-database-query","fullstack-frontend-burst","fullstack-backend-strike","fullstack-deploy","fullstack-scale","fullstack-integration"],"passive":{"name":"Full Power","description":"Deal 20% more damage when HP > 70%"}},{"id":"devops","name":"DevOps","description":"Speed-focused with high critical hit rate and evasion. Hit-and-run tactics.","baseStats":{"HP":95,"ATK":15,"DEF":7,"SPD":14,"MP":45},"statGrowth":{"HP":5,"ATK":2,"DEF":1,"SPD":3,"MP":3},"skillIds":["devops-basic-attack","devops-ci-pipeline","devops-docker-strike","devops-kubernetes-swarm","devops-monitoring","devops-auto-scale","devops-rollback","devops-blue-green"],"passive":{"name":"Agility","description":"+2% evasion per SPD difference, +5% crit rate"}}]}'),p=JSON.parse('{"H":[{"id":"debugger-basic-attack","name":"Console.log","description":"Basic attack that prints the error","class":"debugger","mpCost":0,"cooldown":0,"baseDamage":100,"targetType":"single","effects":[{"type":"damage","value":100}]},{"id":"debugger-breakpoint","name":"Breakpoint","description":"Set a breakpoint to stop the bug","class":"debugger","mpCost":15,"cooldown":0,"baseDamage":150,"targetType":"single","effects":[{"type":"damage","value":150},{"type":"debuff","stat":"SPD","value":-20,"duration":2}]},{"id":"debugger-stack-trace","name":"Stack Trace","description":"Trace back the error origin","class":"debugger","mpCost":20,"cooldown":0,"baseDamage":180,"targetType":"single","effects":[{"type":"damage","value":180}]},{"id":"debugger-watch-variable","name":"Watch Variable","description":"Monitor the bug\'s state","class":"debugger","mpCost":10,"cooldown":0,"baseDamage":0,"targetType":"single","effects":[{"type":"debuff","stat":"DEF","value":-30,"duration":3}]},{"id":"debugger-defensive-stance","name":"Error Handling","description":"Prepare for incoming errors","class":"debugger","mpCost":15,"cooldown":0,"baseDamage":0,"targetType":"self","effects":[{"type":"buff","stat":"DEF","value":50,"duration":3}]},{"id":"debugger-error-handler","name":"Try-Catch Block","description":"Wrap the bug in exception handling","class":"debugger","mpCost":25,"cooldown":2,"baseDamage":200,"targetType":"single","effects":[{"type":"damage","value":200},{"type":"heal","value":30}]},{"id":"debugger-step-through","name":"Step Through","description":"Execute code line by line","class":"debugger","mpCost":30,"cooldown":2,"baseDamage":120,"targetType":"all","effects":[{"type":"damage","value":120}]},{"id":"debugger-assert","name":"Assert","description":"Verify assumptions and break on failure","class":"debugger","mpCost":35,"cooldown":3,"baseDamage":280,"targetType":"single","effects":[{"type":"damage","value":280}]},{"id":"refactorer-basic-attack","name":"Code Review","description":"Find and fix issues","class":"refactorer","mpCost":0,"cooldown":0,"baseDamage":100,"targetType":"single","effects":[{"type":"damage","value":100}]},{"id":"refactorer-clean-code","name":"Clean Code","description":"Refactor messy code","class":"refactorer","mpCost":15,"cooldown":0,"baseDamage":160,"targetType":"single","effects":[{"type":"damage","value":160}]},{"id":"refactorer-extract-method","name":"Extract Method","description":"Isolate and eliminate the bug","class":"refactorer","mpCost":20,"cooldown":0,"baseDamage":170,"targetType":"single","effects":[{"type":"damage","value":170},{"type":"buff","stat":"ATK","value":20,"duration":2}]},{"id":"refactorer-optimize","name":"Optimize","description":"Improve performance","class":"refactorer","mpCost":25,"cooldown":2,"baseDamage":0,"targetType":"self","effects":[{"type":"buff","stat":"ATK","value":40,"duration":3},{"type":"buff","stat":"SPD","value":30,"duration":3}]},{"id":"refactorer-rename","name":"Rename","description":"Clarify the bug\'s purpose","class":"refactorer","mpCost":10,"cooldown":0,"baseDamage":130,"targetType":"single","effects":[{"type":"damage","value":130}]},{"id":"refactorer-inline","name":"Inline","description":"Simplify complexity","class":"refactorer","mpCost":18,"cooldown":0,"baseDamage":150,"targetType":"single","effects":[{"type":"damage","value":150}]},{"id":"refactorer-pattern-apply","name":"Design Pattern","description":"Apply proven solution pattern","class":"refactorer","mpCost":30,"cooldown":2,"baseDamage":220,"targetType":"single","effects":[{"type":"damage","value":220}]},{"id":"refactorer-technical-debt","name":"Pay Tech Debt","description":"Reduce technical debt","class":"refactorer","mpCost":40,"cooldown":3,"baseDamage":0,"targetType":"self","effects":[{"type":"special","value":-15,"description":"Reduce Tech Debt by 15"}]},{"id":"fullstack-basic-attack","name":"HTTP Request","description":"Send a request to the bug","class":"fullstack","mpCost":0,"cooldown":0,"baseDamage":100,"targetType":"single","effects":[{"type":"damage","value":100}]},{"id":"fullstack-api-call","name":"REST API","description":"Call API endpoint","class":"fullstack","mpCost":20,"cooldown":0,"baseDamage":180,"targetType":"single","effects":[{"type":"damage","value":180}]},{"id":"fullstack-database-query","name":"SQL Query","description":"Execute database query","class":"fullstack","mpCost":25,"cooldown":2,"baseDamage":200,"targetType":"single","effects":[{"type":"damage","value":200}]},{"id":"fullstack-frontend-burst","name":"React Render","description":"Rapid frontend updates","class":"fullstack","mpCost":30,"cooldown":2,"baseDamage":140,"targetType":"all","effects":[{"type":"damage","value":140}]},{"id":"fullstack-backend-strike","name":"Server Logic","description":"Execute backend business logic","class":"fullstack","mpCost":35,"cooldown":3,"baseDamage":260,"targetType":"single","effects":[{"type":"damage","value":260}]},{"id":"fullstack-deploy","name":"Deploy","description":"Push to production","class":"fullstack","mpCost":40,"cooldown":3,"baseDamage":300,"targetType":"single","effects":[{"type":"damage","value":300}]},{"id":"fullstack-scale","name":"Horizontal Scale","description":"Scale out the attack","class":"fullstack","mpCost":45,"cooldown":3,"baseDamage":180,"targetType":"all","effects":[{"type":"damage","value":180}]},{"id":"fullstack-integration","name":"System Integration","description":"Integrate all systems for massive damage","class":"fullstack","mpCost":50,"cooldown":3,"baseDamage":400,"targetType":"single","effects":[{"type":"damage","value":400}]},{"id":"devops-basic-attack","name":"Shell Command","description":"Execute a command","class":"devops","mpCost":0,"cooldown":0,"baseDamage":100,"targetType":"single","effects":[{"type":"damage","value":100}]},{"id":"devops-ci-pipeline","name":"CI Pipeline","description":"Automated testing and building","class":"devops","mpCost":20,"cooldown":0,"baseDamage":170,"targetType":"single","effects":[{"type":"damage","value":170}]},{"id":"devops-docker-strike","name":"Container Attack","description":"Deploy containerized attack","class":"devops","mpCost":25,"cooldown":2,"baseDamage":190,"targetType":"single","effects":[{"type":"damage","value":190}]},{"id":"devops-kubernetes-swarm","name":"K8s Orchestration","description":"Coordinate multiple attacks","class":"devops","mpCost":35,"cooldown":3,"baseDamage":160,"targetType":"all","effects":[{"type":"damage","value":160}]},{"id":"devops-monitoring","name":"Monitoring","description":"Observe and alert","class":"devops","mpCost":15,"cooldown":0,"baseDamage":0,"targetType":"self","effects":[{"type":"buff","stat":"SPD","value":50,"duration":3}]},{"id":"devops-auto-scale","name":"Auto-Scale","description":"Dynamically increase resources","class":"devops","mpCost":30,"cooldown":2,"baseDamage":0,"targetType":"self","effects":[{"type":"buff","stat":"ATK","value":60,"duration":3}]},{"id":"devops-rollback","name":"Rollback","description":"Revert to previous state","class":"devops","mpCost":20,"cooldown":0,"baseDamage":0,"targetType":"self","effects":[{"type":"heal","value":60}]},{"id":"devops-blue-green","name":"Blue-Green Deploy","description":"Zero-downtime massive strike","class":"devops","mpCost":45,"cooldown":3,"baseDamage":350,"targetType":"single","effects":[{"type":"damage","value":350}]}]}'),f=JSON.parse('{"S":[{"id":"nullpointer","name":"NullPointerException","description":"The classic null reference error","type":"bug","chapter":1,"stats":{"HP":80,"ATK":12,"DEF":5,"SPD":10},"behaviorTree":{"conditions":[{"type":"hp_below","value":50}],"actions":[{"type":"attack","weight":70},{"type":"skill","skillId":"null-crash","weight":30}]},"drops":{"items":[{"itemId":"basic-potion","dropRate":50}],"exp":50,"gold":20},"techDebtOnSkip":10},{"id":"stackoverflow","name":"StackOverflowError","description":"Infinite recursion nightmare","type":"bug","chapter":1,"stats":{"HP":100,"ATK":15,"DEF":6,"SPD":8},"behaviorTree":{"conditions":[{"type":"hp_below","value":30}],"actions":[{"type":"attack","weight":60},{"type":"skill","skillId":"recursive-call","weight":40}]},"drops":{"items":[{"itemId":"basic-potion","dropRate":40}],"exp":70,"gold":30},"techDebtOnSkip":12},{"id":"racecondition","name":"RaceCondition","description":"Unpredictable concurrent execution","type":"bug","chapter":1,"stats":{"HP":90,"ATK":18,"DEF":4,"SPD":16},"behaviorTree":{"conditions":[{"type":"turn_count","value":3}],"actions":[{"type":"attack","weight":80},{"type":"skill","skillId":"concurrent-strike","weight":20}]},"drops":{"items":[{"itemId":"speed-boost","dropRate":30}],"exp":80,"gold":35},"techDebtOnSkip":15},{"id":"memoryleak","name":"MemoryLeak","description":"Slowly consumes all resources","type":"bug","chapter":1,"stats":{"HP":120,"ATK":10,"DEF":8,"SPD":6},"behaviorTree":{"conditions":[{"type":"hp_above","value":70}],"actions":[{"type":"attack","weight":50},{"type":"skill","skillId":"memory-drain","weight":50}]},"drops":{"items":[{"itemId":"mp-potion","dropRate":60}],"exp":90,"gold":40},"techDebtOnSkip":18},{"id":"deadlock","name":"Deadlock","description":"Two threads waiting for each other","type":"bug","chapter":1,"stats":{"HP":110,"ATK":14,"DEF":12,"SPD":5},"behaviorTree":{"conditions":[{"type":"hp_below","value":60}],"actions":[{"type":"attack","weight":40},{"type":"buff","weight":60}]},"drops":{"items":[{"itemId":"defense-charm","dropRate":40}],"exp":85,"gold":38},"techDebtOnSkip":20},{"id":"offbyone","name":"OffByOneError","description":"Classic array indexing mistake","type":"boss","chapter":1,"stats":{"HP":300,"ATK":20,"DEF":15,"SPD":12},"phase":1,"behaviorTree":{"phases":[{"hpThreshold":100,"conditions":[{"type":"hp_check","value":100}],"actions":[{"type":"attack","weight":60},{"type":"skill","skillId":"index-corruption","weight":30},{"type":"buff","weight":10}]},{"hpThreshold":75,"conditions":[{"type":"hp_check","value":75}],"actions":[{"type":"attack","weight":45},{"type":"skill","skillId":"index-corruption","weight":35},{"type":"skill","skillId":"boundary-breach","weight":15},{"type":"buff","weight":5}]},{"hpThreshold":50,"conditions":[{"type":"hp_check","value":50}],"actions":[{"type":"attack","weight":30},{"type":"skill","skillId":"index-corruption","weight":30},{"type":"skill","skillId":"boundary-breach","weight":30},{"type":"buff","weight":10}]},{"hpThreshold":25,"conditions":[{"type":"hp_check","value":25}],"actions":[{"type":"attack","weight":20},{"type":"skill","skillId":"index-corruption","weight":25},{"type":"skill","skillId":"boundary-breach","weight":45},{"type":"buff","weight":10}]}]},"drops":{"items":[{"itemId":"debugger-badge","dropRate":100},{"itemId":"rare-weapon","dropRate":30}],"exp":200,"gold":100},"techDebtOnSkip":50},{"id":"sqlinjection","name":"SQLInjection","description":"Malicious database query","type":"bug","chapter":2,"stats":{"HP":130,"ATK":22,"DEF":8,"SPD":14},"behaviorTree":{"conditions":[{"type":"hp_below","value":40}],"actions":[{"type":"attack","weight":60},{"type":"skill","skillId":"query-poison","weight":40}]},"drops":{"items":[{"itemId":"sanitize-token","dropRate":50}],"exp":120,"gold":55},"techDebtOnSkip":25},{"id":"xss","name":"CrossSiteScripting","description":"Malicious script injection","type":"bug","chapter":2,"stats":{"HP":110,"ATK":25,"DEF":6,"SPD":16},"behaviorTree":{"conditions":[{"type":"turn_count","value":2}],"actions":[{"type":"attack","weight":70},{"type":"skill","skillId":"script-inject","weight":30}]},"drops":{"items":[{"itemId":"xss-shield","dropRate":45}],"exp":130,"gold":60},"techDebtOnSkip":28},{"id":"bufferoverflow","name":"BufferOverflow","description":"Writing beyond allocated memory","type":"bug","chapter":2,"stats":{"HP":150,"ATK":28,"DEF":10,"SPD":11},"behaviorTree":{"conditions":[{"type":"hp_below","value":50}],"actions":[{"type":"attack","weight":50},{"type":"skill","skillId":"overflow-burst","weight":50}]},"drops":{"items":[{"itemId":"buffer-guard","dropRate":40}],"exp":140,"gold":65},"techDebtOnSkip":30},{"id":"infiniteloop","name":"InfiniteLoop","description":"Never-ending execution","type":"bug","chapter":2,"stats":{"HP":140,"ATK":18,"DEF":12,"SPD":8},"behaviorTree":{"conditions":[{"type":"hp_above","value":60}],"actions":[{"type":"attack","weight":40},{"type":"heal","weight":30},{"type":"buff","weight":30}]},"drops":{"items":[{"itemId":"break-token","dropRate":55}],"exp":135,"gold":62},"techDebtOnSkip":32},{"id":"heisenbug","name":"Heisenbug","description":"Disappears when you try to debug it","type":"boss","chapter":2,"stats":{"HP":400,"ATK":30,"DEF":20,"SPD":18},"phase":1,"behaviorTree":{"phases":[{"hpThreshold":100,"conditions":[{"type":"hp_check","value":100}],"actions":[{"type":"attack","weight":50},{"type":"skill","skillId":"quantum-state","weight":35},{"type":"buff","weight":15}]},{"hpThreshold":75,"conditions":[{"type":"hp_check","value":75}],"actions":[{"type":"attack","weight":35},{"type":"skill","skillId":"quantum-state","weight":30},{"type":"skill","skillId":"observer-effect","weight":25},{"type":"buff","weight":10}]},{"hpThreshold":50,"conditions":[{"type":"hp_check","value":50}],"actions":[{"type":"attack","weight":25},{"type":"skill","skillId":"quantum-state","weight":25},{"type":"skill","skillId":"observer-effect","weight":30},{"type":"skill","skillId":"uncertainty","weight":20}]},{"hpThreshold":25,"conditions":[{"type":"hp_check","value":25}],"actions":[{"type":"attack","weight":15},{"type":"skill","skillId":"observer-effect","weight":25},{"type":"skill","skillId":"uncertainty","weight":50},{"type":"buff","weight":10}]}]},"drops":{"items":[{"itemId":"heisen-crystal","dropRate":100},{"itemId":"epic-armor","dropRate":25}],"exp":300,"gold":150},"techDebtOnSkip":80}]}'),g=JSON.parse('{"$schema":"../schemas/palette.schema.json","name":"VS Code Dark+ Theme","description":"Official VS Code Dark+ color palette for accessibility","colors":{"background":{"primary":"#1e1e1e","secondary":"#252526","elevated":"#2d2d30"},"foreground":{"primary":"#d4d4d4","secondary":"#cccccc","muted":"#858585"},"accent":{"blue":"#569cd6","lightBlue":"#9cdcfe","green":"#4ec9b0","lightGreen":"#4fc1ff","yellow":"#dcdcaa","orange":"#ce9178","red":"#f48771","pink":"#c586c0","purple":"#c678dd"},"semantic":{"error":"#f48771","warning":"#cca700","info":"#75beff","success":"#89d185"},"ui":{"border":"#3e3e42","selection":"#264f78","hover":"#2a2d2e","focus":"#007acc"}},"characterColors":{"debugger":"#569cd6","refactorer":"#4ec9b0","fullstack":"#c586c0","devops":"#dcdcaa"},"bugColors":{"nullpointer":"#f48771","stackoverflow":"#ce9178","racecondition":"#cca700","memoryleak":"#89d185","deadlock":"#858585","offbyone":"#d16969","sqlinjection":"#c586c0","xss":"#ce9178","bufferoverflow":"#f48771","infiniteloop":"#dcdcaa","heisenbug":"#c678dd"},"rarityColors":{"common":"#d4d4d4","rare":"#569cd6","epic":"#c586c0"},"statusColors":{"hp":"#4ec9b0","mp":"#569cd6","atk":"#f48771","def":"#dcdcaa","spd":"#9cdcfe","techDebt":"#ce9178"}}'),m=JSON.parse('{"l":[{"id":"basic-potion","name":"Basic Potion","type":"consumable","rarity":"common","effects":[{"type":"heal","value":30,"duration":0}],"price":20},{"id":"mana-potion","name":"Mana Potion","type":"consumable","rarity":"common","effects":[{"type":"heal","value":20,"duration":0,"stat":"MP"}],"price":25},{"id":"mega-potion","name":"Mega Potion","type":"consumable","rarity":"rare","effects":[{"type":"heal","value":80,"duration":0}],"price":60},{"id":"full-restore","name":"Full Restore","type":"consumable","rarity":"epic","effects":[{"type":"heal","value":999,"duration":0},{"type":"heal","value":999,"duration":0,"stat":"MP"}],"price":150},{"id":"rusty-sword","name":"Rusty Sword","type":"weapon","rarity":"common","statBonus":{"ATK":3},"price":50},{"id":"iron-sword","name":"Iron Sword","type":"weapon","rarity":"common","statBonus":{"ATK":8},"price":150},{"id":"steel-blade","name":"Steel Blade","type":"weapon","rarity":"rare","statBonus":{"ATK":15},"price":400},{"id":"debugger-hammer","name":"Debugger\'s Hammer","type":"weapon","rarity":"epic","statBonus":{"ATK":25,"DEF":5},"price":1000},{"id":"cloth-armor","name":"Cloth Armor","type":"armor","rarity":"common","statBonus":{"DEF":3,"HP":10},"price":40},{"id":"leather-vest","name":"Leather Vest","type":"armor","rarity":"common","statBonus":{"DEF":7,"HP":20},"price":120},{"id":"chainmail","name":"Chainmail","type":"armor","rarity":"rare","statBonus":{"DEF":12,"HP":40},"price":350},{"id":"refactor-plate","name":"Refactorer\'s Plate","type":"armor","rarity":"epic","statBonus":{"DEF":20,"HP":80},"price":900},{"id":"speed-boots","name":"Speed Boots","type":"accessory","rarity":"common","statBonus":{"SPD":3},"price":80},{"id":"power-ring","name":"Power Ring","type":"accessory","rarity":"rare","statBonus":{"ATK":5,"MP":10},"price":250},{"id":"defense-pendant","name":"Defense Pendant","type":"accessory","rarity":"rare","statBonus":{"DEF":5,"HP":15},"price":220},{"id":"fullstack-amulet","name":"FullStack Amulet","type":"accessory","rarity":"epic","statBonus":{"ATK":8,"DEF":8,"SPD":8},"price":800}]}');class y{static getInstance(){return y.instance||(y.instance=new y),y.instance}loadData(){u.L.forEach(t=>{this.classes.set(t.id,t)}),p.H.forEach(t=>{this.skills.set(t.id,t)}),f.S.forEach(t=>{this.bugs.set(t.id,t)}),m.l.forEach(t=>{this.items.set(t.id,t)}),console.log("DataLoader: Loaded ".concat(this.classes.size," classes, ").concat(this.skills.size," skills, ").concat(this.bugs.size," bugs, ").concat(this.items.size," items"))}getClass(t){return this.classes.get(t)}getAllClasses(){return Array.from(this.classes.values())}getSkill(t){return this.skills.get(t)}getSkillsForClass(t){let e=this.getClass(t);return e?e.skillIds.map(t=>this.getSkill(t)).filter(t=>void 0!==t):[]}getBug(t){return this.bugs.get(t)}getBugsForChapter(t){return Array.from(this.bugs.values()).filter(e=>e.chapter===t)}getBossForChapter(t){return Array.from(this.bugs.values()).find(e=>e.chapter===t&&"boss"===e.type)}getColor(t,e){let s=this.palette.colors[t];return s&&s[e]||"#ffffff"}getCharacterColor(t){return this.palette.characterColors[t]||"#ffffff"}getBugColor(t){return this.palette.bugColors[t]||"#ffffff"}getStatusColor(t){return this.palette.statusColors[t]||"#ffffff"}getItem(t){return this.items.get(t)}getAllItems(){return Array.from(this.items.values())}getItemsByType(t){return Array.from(this.items.values()).filter(e=>e.type===t)}getItemsByRarity(t){return Array.from(this.items.values()).filter(e=>e.rarity===t)}constructor(){this.classes=new Map,this.skills=new Map,this.bugs=new Map,this.items=new Map,this.loadData(),this.palette=g}}let b=y.getInstance();function x(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=b.getClass(t);if(!i)throw Error("Class not found: ".concat(t));let a=function(t,e){let s=t.baseStats,i=t.statGrowth;return{HP:s.HP+i.HP*(e-1),ATK:s.ATK+i.ATK*(e-1),DEF:s.DEF+i.DEF*(e-1),SPD:s.SPD+i.SPD*(e-1),MP:s.MP+i.MP*(e-1)}}(i,s),r=i.skillIds.map(t=>{var e,s;let i=b.getSkill(t);return i?{id:(e=i).id,name:e.name,description:e.description,mpCost:e.mpCost,cooldown:null!=(s=e.cooldown)?s:0,currentCooldown:0,effects:e.effects.map(t=>({type:t.type,value:t.value,duration:t.duration,stat:t.stat})),targetType:e.targetType}:(console.warn("Skill not found: ".concat(t)),null)}).filter(t=>null!==t);return{id:"char-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),name:e,class:t,level:s,exp:0,gold:0,stats:a,currentHP:a.HP,currentMP:a.MP,skills:r,equipment:{},inventory:[]}}class S extends n().Scene{create(){let t=this.cameras.main.width,e=this.cameras.main.height;this.add.rectangle(t/2,e/2,t,e,1973790),this.add.text(t/2,80,"Choose Your Class",{fontSize:"36px",color:"#4a90e2"}).setOrigin(.5),b.getAllClasses().map(t=>({id:t.id,name:t.name,description:t.description,baseStats:t.baseStats,passive:t.passive,color:b.getCharacterColor(t.id)})).forEach((t,e)=>{let s=100+180*e,i=this.add.rectangle(s,180,160,200,parseInt(t.color.replace("#","0x"),16),.2);i.setStrokeStyle(2,parseInt(t.color.replace("#","0x"),16)),i.setInteractive(),this.add.text(s,110,t.name,{fontSize:"20px",color:t.color}).setOrigin(.5);let a=["HP: ".concat(t.baseStats.HP),"ATK: ".concat(t.baseStats.ATK),"DEF: ".concat(t.baseStats.DEF),"SPD: ".concat(t.baseStats.SPD),"MP: ".concat(t.baseStats.MP)].join("\n");this.add.text(s,160,a,{fontSize:"14px",color:"#d4d4d4",align:"center"}).setOrigin(.5),this.add.text(s,240,t.passive.name,{fontSize:"12px",color:"#9cdcfe"}).setOrigin(.5),i.on("pointerover",()=>{i.setFillStyle(parseInt(t.color.replace("#","0x"),16),.4)}),i.on("pointerout",()=>{i.setFillStyle(parseInt(t.color.replace("#","0x"),16),.2)}),i.on("pointerdown",()=>{console.log("Selected class: ".concat(t.id));let e=x(t.id,t.name,1);this.isFirstGame?this.scene.start("TutorialScene",{party:[e]}):this.scene.start("DungeonSelectScene",{party:[e]})})}),this.add.text(t/2,e-100,"Click a class to begin your journey",{fontSize:"18px",color:"#858585"}).setOrigin(.5)}constructor(){super({key:"ClassSelectScene"}),this.isFirstGame=!0}}class v extends n().Scene{create(t){let e=this.cameras.main.width,s=this.cameras.main.height;this.tutorialStep=0,this.focusActive=!1,(null==t?void 0:t.party)&&t.party.length>0?this.playerData=t.party[0]:this.playerData={id:"player-1",name:"Recruit",class:"Debugger",level:1,exp:0,gold:0,stats:{HP:100,ATK:15,DEF:8,SPD:12,MP:50},currentHP:100,currentMP:50,skills:[],equipment:{},inventory:[]},this.tutorialBug={id:"tutorial-nullpointer",name:"NullPointerException",type:"bug",chapter:1,stats:{HP:50,ATK:8,DEF:3,SPD:8},currentHP:50,behaviorTree:{conditions:[],actions:[{type:"attack",weight:100}]},drops:{items:[],exp:25,gold:10},techDebtOnSkip:5},this.add.rectangle(e/2,s/2,e,s,1973790),this.createBattleLayout(),this.createActionButtons(),this.createSkipButton(),this.showTutorialStep()}createBattleLayout(){let t=this.cameras.main.width,e=this.cameras.main.height;if(!this.playerData||!this.tutorialBug)return;let s=.25*t,i=.45*e;this.add.rectangle(s,i,64,64,5676246,.5).setStrokeStyle(2,5676246),this.add.text(s,i-80,this.playerData.name,{fontSize:"18px",color:"#d4d4d4"}).setOrigin(.5),this.add.rectangle(s,i+55,120,14,4079170),this.playerHPBar=this.add.rectangle(s-60,i+55,120,14,5163440).setOrigin(0,.5),this.playerHPLabel=this.add.text(s,i+55,"",{fontSize:"11px",color:"#ffffff"}).setOrigin(.5),this.add.rectangle(s,i+75,120,14,4079170),this.playerMPBar=this.add.rectangle(s-60,i+75,120,14,5676246).setOrigin(0,.5),this.playerMPLabel=this.add.text(s,i+75,"",{fontSize:"11px",color:"#ffffff"}).setOrigin(.5);let a=.75*t,r=.38*e;this.add.rectangle(a,r,64,64,0xf48771,.5).setStrokeStyle(2,0xf48771),this.add.text(a,r-80,this.tutorialBug.name,{fontSize:"18px",color:"#f48771"}).setOrigin(.5),this.add.rectangle(a,r+55,120,14,4079170),this.bugHPBar=this.add.rectangle(a-60,r+55,120,14,0xf48771).setOrigin(0,.5),this.bugHPLabel=this.add.text(a,r+55,"",{fontSize:"11px",color:"#ffffff"}).setOrigin(.5),this.refreshBars()}createActionButtons(){let t=this.cameras.main.width,e=this.cameras.main.height-90,s=(t-528)/2+60;this.attackButton=this.makeButton(s,e,120,48,"Attack","#f48771",()=>this.handleAction("attack")),this.skillButton=this.makeButton(s+120+16,e,120,48,"Skill","#569cd6",()=>this.handleAction("skill")),this.focusButton=this.makeButton(s+272,e,120,48,"Focus","#dcdcaa",()=>this.handleAction("focus")),this.itemButton=this.makeButton(s+408,e,120,48,"Item","#4ec9b0",()=>this.handleAction("item")),this.setAllButtonsEnabled(!1)}makeButton(t,e,s,i,a,r,n){let l=this.add.container(t,e),o=parseInt(r.replace("#","0x"),16),c=this.add.rectangle(0,0,s,i,o,.15);c.setStrokeStyle(2,o),c.setInteractive();let h=this.add.text(0,0,a,{fontSize:"16px",color:r,fontStyle:"bold"}).setOrigin(.5);return l.add([c,h]),c.on("pointerover",()=>{var t;(null==(t=c.input)?void 0:t.enabled)&&c.setFillStyle(o,.35)}),c.on("pointerout",()=>c.setFillStyle(o,.15)),c.on("pointerdown",()=>{var t;(null==(t=c.input)?void 0:t.enabled)&&n()}),l}setAllButtonsEnabled(t){[this.attackButton,this.skillButton,this.focusButton,this.itemButton].forEach(e=>{if(!e)return;let s=e.list[0];s.input&&(s.input.enabled=t),e.setAlpha(t?1:.4)})}setSingleButtonEnabled(t,e){if(!t)return;let s=t.list[0];s.input&&(s.input.enabled=e),t.setAlpha(e?1:.4)}createSkipButton(){let t=this.cameras.main.width,e=this.add.text(t-16,16,"Skip Tutorial >>",{fontSize:"14px",color:"#858585",backgroundColor:"#2d2d30",padding:{x:12,y:6}}).setOrigin(1,0).setDepth(100).setInteractive();e.on("pointerover",()=>e.setColor("#d4d4d4")),e.on("pointerout",()=>e.setColor("#858585")),e.on("pointerdown",()=>this.endTutorial())}showTutorialStep(){switch(this.clearHighlight(),this.tutorialStep){case 0:this.showMessage("Welcome, Bug Slayer!","Your mission: squash bugs and save the codebase.\nLet's learn the basics of combat.",0),this.input.once("pointerdown",()=>{this.tutorialStep=1,this.showTutorialStep()});break;case 1:this.showMessage("Step 1: Attack","Click Attack to deal damage to the bug.\nThis is your bread-and-butter action.",1),this.highlightButton(this.attackButton,"#f48771"),this.setSingleButtonEnabled(this.attackButton,!0);break;case 2:this.showMessage("Step 2: Skills","Skills cost MP but deal more damage.\nUnlock powerful skills as you level up!",2),this.highlightButton(this.skillButton,"#569cd6"),this.setSingleButtonEnabled(this.skillButton,!0);break;case 3:this.showMessage("Step 3: Focus","Focus restores 15% MP and boosts your\nnext attack by +20% damage.",3),this.highlightButton(this.focusButton,"#dcdcaa"),this.setSingleButtonEnabled(this.focusButton,!0);break;case 4:this.showMessage("Step 4: Items","Use items to heal HP during battle.\nStock up between fights!",4),this.highlightButton(this.itemButton,"#4ec9b0"),this.setSingleButtonEnabled(this.itemButton,!0);break;case 5:this.showMessage("Finish the Bug!","Use any action to defeat the NullPointerException.\nGood luck, Bug Slayer!",5),this.setAllButtonsEnabled(!0)}}showMessage(t,e,s){this.messageBox&&(this.messageBox.removeAll(!0),this.messageBox.destroy()),this.stepIndicator&&this.stepIndicator.destroy();let i=this.cameras.main.width;this.messageBox=this.add.container(i/2,80).setDepth(50);let a=Math.min(480,i-40),r=this.add.rectangle(0,0,a,90,2434342,.95);r.setStrokeStyle(2,31436),this.messageBox.add(r);let n=this.add.text(0,-22,t,{fontSize:"20px",color:"#4fc1ff",fontStyle:"bold",align:"center"}).setOrigin(.5);this.messageBox.add(n);let l=this.add.text(0,14,e,{fontSize:"14px",color:"#d4d4d4",align:"center",lineSpacing:4}).setOrigin(.5);if(this.messageBox.add(l),s>0&&s<=this.TOTAL_STEPS){let t=[];for(let e=1;e<=this.TOTAL_STEPS;e++)t.push(e<=s?"●":"○");this.stepIndicator=this.add.text(i/2,135,t.join("  "),{fontSize:"14px",color:"#007acc"}).setOrigin(.5).setDepth(50)}this.messageBox.setAlpha(0),this.tweens.add({targets:this.messageBox,alpha:1,duration:300,ease:"Power2"})}highlightButton(t,e){if(!t)return;let s=t.getBounds(),i=parseInt((e||"#007acc").replace("#","0x"),16),a=this.cameras.main.width,r=this.cameras.main.height;this.overlay=this.add.rectangle(a/2,r/2,a,r,0,.5).setDepth(20),t.setDepth(30),this.highlightRect=this.add.rectangle(s.centerX,s.centerY,s.width+16,s.height+16).setDepth(25),this.highlightRect.setStrokeStyle(3,i),this.highlightRect.setFillStyle(0,0),this.highlightTween=this.tweens.add({targets:this.highlightRect,scaleX:1.08,scaleY:1.12,duration:600,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.arrowContainer=this.add.container(s.centerX,s.top-50).setDepth(30);let n=this.add.rectangle(0,0,4,30,i).setOrigin(.5,0);this.arrowContainer.add(n);let l=this.add.graphics();l.fillStyle(i,1),l.fillTriangle(0,30,-9,18,9,18),this.arrowContainer.add(l),this.tweens.add({targets:this.arrowContainer,y:s.top-38,duration:500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}clearHighlight(){this.highlightTween&&(this.highlightTween.stop(),this.highlightTween=void 0),this.highlightRect&&(this.highlightRect.destroy(),this.highlightRect=void 0),this.arrowContainer&&(this.arrowContainer.removeAll(!0),this.arrowContainer.destroy(),this.arrowContainer=void 0),this.overlay&&(this.overlay.destroy(),this.overlay=void 0),[this.attackButton,this.skillButton,this.focusButton,this.itemButton].forEach(t=>{null==t||t.setDepth(0)}),this.setAllButtonsEnabled(!1)}handleAction(t){if(!this.tutorialBug||!this.playerData)return;let e=0,s="";switch(t){case"attack":e=Math.floor(this.playerData.stats.ATK*(this.focusActive?1:.8)),s="Attack dealt ".concat(e," damage!"),this.focusActive=!1;break;case"skill":{let t=this.focusActive?1.8:1.5;e=Math.floor(this.playerData.stats.ATK*t),this.playerData.currentMP=Math.max(0,this.playerData.currentMP-10),s="Skill hit for ".concat(e," damage! (-10 MP)"),this.focusActive=!1;break}case"focus":{let t=Math.floor(.15*this.playerData.stats.MP);this.playerData.currentMP=Math.min(this.playerData.stats.MP,this.playerData.currentMP+t),this.focusActive=!0,s="Focused! +".concat(t," MP. Next attack +20%!");break}case"item":this.playerData.currentHP=Math.min(this.playerData.stats.HP,this.playerData.currentHP+30),s="Used potion! +".concat(30," HP")}if(e>0&&(this.tutorialBug.currentHP=Math.max(0,this.tutorialBug.currentHP-e)),this.refreshBars(),this.showFloatingText(s,this.cameras.main.width/2,200),this.tutorialBug.currentHP<=0){this.setAllButtonsEnabled(!1),this.clearHighlight(),this.time.delayedCall(800,()=>this.showVictory());return}this.setAllButtonsEnabled(!1),this.time.delayedCall(900,()=>this.bugTurn())}bugTurn(){if(!this.tutorialBug||!this.playerData)return;let t=Math.floor(.5*this.tutorialBug.stats.ATK);this.playerData.currentHP=Math.max(0,this.playerData.currentHP-t),this.refreshBars(),this.showFloatingText("Bug attacked! -".concat(t," HP"),this.cameras.main.width/2,200),this.time.delayedCall(900,()=>{this.tutorialStep<5&&this.tutorialStep++,this.showTutorialStep()})}refreshBars(){if(!this.playerData||!this.tutorialBug)return;let t=this.playerData.currentHP/this.playerData.stats.HP,e=this.playerData.currentMP/this.playerData.stats.MP,s=this.tutorialBug.currentHP/this.tutorialBug.stats.HP;this.playerHPBar&&this.playerHPBar.setScale(Math.max(0,t),1),this.playerMPBar&&this.playerMPBar.setScale(Math.max(0,e),1),this.bugHPBar&&this.bugHPBar.setScale(Math.max(0,s),1),this.playerHPLabel&&this.playerHPLabel.setText("HP ".concat(this.playerData.currentHP,"/").concat(this.playerData.stats.HP)),this.playerMPLabel&&this.playerMPLabel.setText("MP ".concat(this.playerData.currentMP,"/").concat(this.playerData.stats.MP)),this.bugHPLabel&&this.bugHPLabel.setText("HP ".concat(this.tutorialBug.currentHP,"/").concat(this.tutorialBug.stats.HP))}showFloatingText(t,e,s){let i=this.add.text(e,s,t,{fontSize:"22px",color:"#89d185",backgroundColor:"#1e1e1e",padding:{x:10,y:5}}).setOrigin(.5).setDepth(60);this.tweens.add({targets:i,y:s-50,alpha:0,duration:1500,ease:"Cubic.easeOut",onComplete:()=>i.destroy()})}showVictory(){let t=this.cameras.main.width,e=this.cameras.main.height;this.messageBox&&(this.messageBox.removeAll(!0),this.messageBox.destroy(),this.messageBox=void 0),this.stepIndicator&&(this.stepIndicator.destroy(),this.stepIndicator=void 0),this.add.rectangle(t/2,e/2,t,e,0,.7).setDepth(70),this.add.text(t/2,e/2-80,"Victory!",{fontSize:"48px",color:"#89d185",fontStyle:"bold"}).setOrigin(.5).setDepth(80),this.add.text(t/2,e/2-20,"Tutorial Complete!",{fontSize:"24px",color:"#dcdcaa"}).setOrigin(.5).setDepth(80),this.add.text(t/2,e/2+20,"+25 EXP  +10 Gold",{fontSize:"16px",color:"#d4d4d4"}).setOrigin(.5).setDepth(80),this.add.text(t/2,e/2+50,"Now choose your class and enter the dungeons!",{fontSize:"14px",color:"#858585"}).setOrigin(.5).setDepth(80);let s=this.add.rectangle(t/2,e/2+110,220,50,31436,.25).setStrokeStyle(2,31436).setInteractive().setDepth(80);this.add.text(t/2,e/2+110,"Choose Class",{fontSize:"20px",color:"#4fc1ff",fontStyle:"bold"}).setOrigin(.5).setDepth(80),s.on("pointerover",()=>s.setFillStyle(31436,.5)),s.on("pointerout",()=>s.setFillStyle(31436,.25)),s.on("pointerdown",()=>this.endTutorial())}endTutorial(){this.scene.start("ClassSelectScene")}constructor(){super({key:"TutorialScene"}),this.tutorialStep=0,this.TOTAL_STEPS=5,this.focusActive=!1}}class P{get current(){return this.debt}set current(t){this.debt=Math.max(this.MIN,Math.min(this.MAX,t))}get level(){return this.debt<=20?"clean":this.debt<=50?"warning":this.debt<=80?"danger":"crisis"}get enemyAtkModifier(){switch(this.level){case"clean":return .8;case"warning":return 1;case"danger":return 1.3;case"crisis":return 1.5}}getStatus(){return{current:this.debt,level:this.level,enemyAtkModifier:this.enemyAtkModifier,description:({clean:"청결 - 시스템 안정",warning:"경고 - 관리 필요",danger:"위험 - 즉시 조치 요망",crisis:"위기 - 시스템 붕괴 직전"})[this.level],color:({clean:"#4ade80",warning:"#fbbf24",danger:"#f97316",crisis:"#ef4444"})[this.level]}}increase(t){let e=this.debt;return this.debt=Math.min(this.MAX,this.debt+t),this.debt-e}decrease(t){let e=this.debt;return this.debt=Math.max(this.MIN,this.debt-t),e-this.debt}skipBattle(){return this.increase(10)}flee(){return this.increase(5)}killWarning(){return this.decrease(15)}turnPassed(){return this.increase(1)}getEndingType(){return this.debt<40?"good":this.debt<=70?"normal":"bad"}canGetSecretEnding(){return 0===this.debt}toJSON(){return{debt:this.debt}}static fromJSON(t){return new P(t.debt)}reset(){this.debt=0}constructor(t=0){this.debt=0,this.MIN=0,this.MAX=100,this.debt=Math.max(this.MIN,Math.min(this.MAX,t))}}class w extends n().Scene{init(t){if(this.playerClass=t.playerClass,this.player=t.player,this.playTime=t.playTime||0,t.progression)this.progression=t.progression;else{this.progression=new h;let t=h.loadSave();t&&this.progression.loadProgress(t)}void 0!==t.techDebt?this.techDebt=new P(t.techDebt):this.techDebt=new P(this.progression.getTotalTechDebt()),this.selectedChapter=this.progression.getCurrentChapter()}create(){let t=this.cameras.main.width,e=this.cameras.main.height;this.add.rectangle(t/2,e/2,t,e,1973790),this.add.text(t/2,30,"Select Your Dungeon",{fontSize:"32px",color:"#4a90e2"}).setOrigin(.5),this.createChapterSelection(),this.createTechDebtDisplay(),this.createStageInfoPanel(),this.createStartButton(),this.createBackButton(),this.createStageGrid()}createChapterSelection(){let t=this.cameras.main.width/2-280-20;this.createChapterCard(1,"Bug Forest","#4ec9b0",t,100,280,120),this.createChapterCard(2,"Server Dungeon","#4a90e2",t+280+40,100,280,120)}createChapterCard(t,e,s,i,a,r,n){let l=this.add.container(i,a),o=this.progression.getChapterProgress(t),c=this.progression.isChapterUnlocked(t),h=this.selectedChapter===t,d=this.add.rectangle(0,0,r,n,parseInt(s.replace("#","0x"),16),h?.3:.1);d.setStrokeStyle(h?4:2,parseInt(s.replace("#","0x"),16)),l.add(d);let u=this.add.text(0,-35,"Chapter ".concat(t),{fontSize:"20px",color:c?s:"#858585"}).setOrigin(.5);l.add(u);let p=this.add.text(0,-15,e,{fontSize:"16px",color:c?"#d4d4d4":"#858585"}).setOrigin(.5);if(l.add(p),c){let t=this.add.text(0,15,"Stages: ".concat((null==o?void 0:o.stagesCompleted)||0," / ").concat((null==o?void 0:o.totalStages)||0),{fontSize:"14px",color:"#d4d4d4"}).setOrigin(.5);l.add(t);let e=this.add.text(0,35,(null==o?void 0:o.bossDefeated)?"✓ Boss Defeated":"Boss: Not Defeated",{fontSize:"12px",color:(null==o?void 0:o.bossDefeated)?"#4ec9b0":"#f48771"}).setOrigin(.5);l.add(e)}else{let t=this.add.text(0,20,"\uD83D\uDD12",{fontSize:"32px"}).setOrigin(.5);l.add(t)}c&&(d.setInteractive(),d.on("pointerover",()=>{d.setFillStyle(parseInt(s.replace("#","0x"),16),.3)}),d.on("pointerout",()=>{this.selectedChapter!==t&&d.setFillStyle(parseInt(s.replace("#","0x"),16),.1)}),d.on("pointerdown",()=>{this.selectChapter(t)})),this.chapterCards.set(t,l)}selectChapter(t){this.selectedChapter=t,this.chapterCards.forEach((e,s)=>{let i=e.getAt(0),a=s===t,r=this.progression.getChapterProgress(s),n=1===s?"#4ec9b0":"#4a90e2";a?(i.setStrokeStyle(4,parseInt(n.replace("#","0x"),16)),i.setFillStyle(parseInt(n.replace("#","0x"),16),.3)):(null==r?void 0:r.unlocked)&&(i.setStrokeStyle(2,parseInt(n.replace("#","0x"),16)),i.setFillStyle(parseInt(n.replace("#","0x"),16),.1))}),this.createStageGrid(),this.selectedStage=void 0,this.stageInfoPanel&&this.stageInfoPanel.setVisible(!1),this.startButton&&this.startButton.setVisible(!1)}createStageGrid(){this.stageNodes.forEach(t=>{var e,s,i;null==(e=t.circle)||e.destroy(),null==(s=t.text)||s.destroy(),null==(i=t.icon)||i.destroy()}),this.stageNodes=[];let t=this.cameras.main.width,e=this.dataLoader.getBugsForChapter(this.selectedChapter),s=this.dataLoader.getBossForChapter(this.selectedChapter);if(0===e.length)return;let i=[...e.filter(t=>"boss"!==t.type),...s?[s]:[]],a=t/2-(i.length-1)*120/2;i.forEach((t,e)=>{let s,i,r,n,l,o=e+1,c=a+120*e,h=this.progression.isStageUnlocked(this.selectedChapter,o),d=this.progression.getStageProgress(this.selectedChapter,o),u=(null==d?void 0:d.completed)||!1,p=this.progression.getCurrentChapter()===this.selectedChapter&&this.progression.getCurrentStage()===o;s=u?"completed":p&&h?"current":"locked";let f={chapter:this.selectedChapter,stage:o,bug:t,status:s,x:c,y:320};if(e>0){let t=this.stageNodes[e-1];if(t){let e=u||"completed"===t.status?5163440:8750469,s=this.add.line(0,0,t.x,t.y,c,320,e,.5);s.setOrigin(0),s.setDepth(-1)}}"boss"===t.type?(r=35,i=0xf48771,n=h?1:.3):(r=25,"completed"===s?(i=5163440,n=1):"current"===s?(i=0xdcdcaa,n=1):(i=8750469,n=.5));let g=this.add.circle(c,320,r,i,n);g.setStrokeStyle(2,0xd4d4d4),f.circle=g,l="completed"===s?"✓":"locked"===s?"\uD83D\uDD12":"▶",f.icon=this.add.text(c,320,l,{fontSize:"boss"===t.type?"24px":"18px",color:"#ffffff"}).setOrigin(.5),f.text=this.add.text(c,320+r+15,t.name,{fontSize:"12px",color:h?"#d4d4d4":"#858585",align:"center",wordWrap:{width:100}}).setOrigin(.5),h&&(g.setInteractive(),g.on("pointerover",()=>{g.setScale(1.1),this.showStageInfo(f)}),g.on("pointerout",()=>{this.selectedStage!==f&&g.setScale(1)}),g.on("pointerdown",()=>{this.selectStage(f)})),"current"===s&&this.tweens.add({targets:g,scale:{from:1,to:1.15},alpha:{from:1,to:.7},duration:1e3,yoyo:!0,repeat:-1}),this.stageNodes.push(f)})}showStageInfo(t){if(!this.stageInfoPanel)return;let e=t.bug,s=e.drops.exp,i=e.drops.gold,a=this.stageInfoPanel.list;a[1].setText(e.name),a[2].setText("boss"===e.type?"\uD83D\uDD25 BOSS":"Type: ".concat(e.type)),a[3].setText("HP: ".concat(e.stats.HP," | ATK: ").concat(e.stats.ATK," | DEF: ").concat(e.stats.DEF," | SPD: ").concat(e.stats.SPD)),a[4].setText(e.description),a[5].setText("Rewards: ".concat(s," EXP, ").concat(i," Gold")),this.stageInfoPanel.setVisible(!0)}selectStage(t){this.selectedStage&&this.selectedStage.circle&&this.selectedStage.circle.setScale(1),this.selectedStage=t,t.circle&&t.circle.setScale(1.1),this.showStageInfo(t),this.startButton&&this.startButton.setVisible(!0)}createTechDebtDisplay(){let t=this.cameras.main.height-80,e=this.techDebt.getStatus();this.add.text(20,t-25,"Tech Debt",{fontSize:"14px",color:"#d4d4d4"}),this.add.rectangle(120,t,200,20,3947580);let s=e.current/100*200;this.techDebtBar=this.add.graphics(),this.techDebtBar.fillStyle(parseInt(e.color.replace("#","0x"),16),1),this.techDebtBar.fillRect(20,t-10,s,20),this.add.text(230,t,"".concat(e.current," / 100"),{fontSize:"14px",color:e.color}).setOrigin(0,.5),this.add.text(20,t+20,e.description,{fontSize:"12px",color:e.color})}createStageInfoPanel(){let t=this.cameras.main.width,e=this.cameras.main.height-90-20,s=this.add.container(t-200-20,e),i=this.add.rectangle(0,0,400,180,2960685,.9);i.setStrokeStyle(2,4886754),s.add(i);let a=this.add.text(0,-70,"Bug Info",{fontSize:"16px",color:"#4a90e2"}).setOrigin(.5);s.add(a);let r=this.add.text(0,-45,"",{fontSize:"18px",color:"#d4d4d4"}).setOrigin(.5);s.add(r);let n=this.add.text(0,-25,"",{fontSize:"14px",color:"#c586c0"}).setOrigin(.5);s.add(n);let l=this.add.text(0,-5,"",{fontSize:"12px",color:"#9cdcfe"}).setOrigin(.5);s.add(l);let o=this.add.text(0,25,"",{fontSize:"12px",color:"#d4d4d4",align:"center",wordWrap:{width:360}}).setOrigin(.5);s.add(o);let c=this.add.text(0,60,"",{fontSize:"12px",color:"#dcdcaa"}).setOrigin(.5);s.add(c),s.setVisible(!1),this.stageInfoPanel=s}createStartButton(){let t=this.cameras.main.width,e=this.cameras.main.height-60,s=this.add.container(t/2,e),i=this.add.rectangle(0,0,200,50,4886754,.8);i.setStrokeStyle(2,4886754),i.setInteractive(),s.add(i);let a=this.add.text(0,0,"Enter Battle",{fontSize:"20px",color:"#ffffff"}).setOrigin(.5);s.add(a),i.on("pointerover",()=>{i.setFillStyle(4886754,1)}),i.on("pointerout",()=>{i.setFillStyle(4886754,.8)}),i.on("pointerdown",()=>{this.startBattle()}),s.setVisible(!1),this.startButton=s}createBackButton(){let t=this.add.container(80,30),e=this.add.rectangle(0,0,120,40,8750469,.5);e.setStrokeStyle(2,8750469),e.setInteractive(),t.add(e);let s=this.add.text(0,0,"Back",{fontSize:"16px",color:"#d4d4d4"}).setOrigin(.5);t.add(s),e.on("pointerover",()=>{e.setFillStyle(8750469,.8)}),e.on("pointerout",()=>{e.setFillStyle(8750469,.5)}),e.on("pointerdown",()=>{this.goBack()})}startBattle(){this.selectedStage&&(console.log("Starting battle: Chapter ".concat(this.selectedStage.chapter,", Stage ").concat(this.selectedStage.stage)),this.scene.start("BattleScene",{playerClass:this.playerClass,player:this.player,chapter:this.selectedStage.chapter,stage:this.selectedStage.stage,techDebt:this.techDebt.current,progression:this.progression,playTime:this.playTime}))}goBack(){this.player?this.scene.start("MainMenuScene"):this.scene.start("ClassSelectScene")}constructor(){super({key:"DungeonSelectScene"}),this.playerClass="",this.playTime=0,this.selectedChapter=1,this.stageNodes=[],this.chapterCards=new Map,this.dataLoader=y.getInstance(),this.progression=new h,this.techDebt=new P(0)}}class k{get turns(){return this.turnCount}get phase(){return this.currentPhase}incrementTurn(){this.turnCount++}getHPPercentage(){return this.monster.currentHP/this.monster.stats.HP*100}evaluateCondition(t){switch(t.type){case"hp_below":return this.getHPPercentage()<=t.value;case"hp_above":return this.getHPPercentage()>=t.value;case"turn_count":return this.turnCount>=t.value;case"phase_change":let e=this.getHPPercentage();if(2===t.value&&e<=75&&1===this.currentPhase)return this.currentPhase=2,!0;if(3===t.value&&e<=50&&2===this.currentPhase)return this.currentPhase=3,!0;if(4===t.value&&e<=25&&3===this.currentPhase)return this.currentPhase=4,!0;return!1;default:return!1}}updateBossPhase(){var t;let e=null==(t=this.monster.behaviorTree)?void 0:t.phases;if(!e||0===e.length)return;let s=this.getHPPercentage(),i=1;for(let t=e.length-1;t>=0;t--)s<=e[t].hpThreshold&&(i=t+1);this.currentPhase=i}evaluateConditions(){var t,e;if(null==(t=this.monster.behaviorTree)?void 0:t.phases)return this.updateBossPhase(),!0;if(!(null==(e=this.monster.behaviorTree)?void 0:e.conditions))return!0;let s=this.monster.behaviorTree.conditions,i=s.filter(t=>"phase_change"===t.type),a=s.filter(t=>"phase_change"!==t.type),r=0===a.length||a.every(t=>this.evaluateCondition(t)),n=0===i.length||i.some(t=>this.evaluateCondition(t));return r&&n}getActionsForCurrentPhase(){var t,e;let s=null==(t=this.monster.behaviorTree)?void 0:t.phases;if(s&&s.length>0){let t=Math.min(this.currentPhase-1,s.length-1),e=s[t];if((null==e?void 0:e.actions)&&e.actions.length>0)return e.actions}return(null==(e=this.monster.behaviorTree)?void 0:e.actions)||null}selectAction(){let t=this.getActionsForCurrentPhase();if(!t||0===t.length)return null;let e=Math.random()*t.reduce((t,e)=>t+e.weight,0);for(let s of t)if((e-=s.weight)<=0)return s;return t[0]||null}convertAction(t){switch(t.type){case"attack":default:return{type:"attack"};case"skill":return{type:"skill",skillId:t.skillId||"basic-skill"};case"buff":return{type:"buff",targetStat:"ATK",modifier:1.2};case"heal":return{type:"heal",amount:20}}}getPhaseDescription(){return"boss"!==this.monster.type?"":({1:"Phase 1: Initial Pattern",2:"Phase 2: Enhanced Pattern (HP < 75%)",3:"Phase 3: Aggressive Pattern (HP < 50%)",4:"Phase 4: Desperate Pattern (HP < 25%)"})[this.currentPhase]||""}decideAction(){if(this.incrementTurn(),!this.evaluateConditions())return{type:"attack"};let t=this.selectAction();return t?this.convertAction(t):{type:"attack"}}reset(){this.turnCount=0,this.currentPhase=this.monster.phase||1}getDebugInfo(){return{turnCount:this.turnCount,currentPhase:this.currentPhase,hpPercent:this.getHPPercentage(),isBoss:"boss"===this.monster.type}}constructor(t){this.turnCount=0,this.currentPhase=1,this.monster=t,this.currentPhase=t.phase||1}}class C{getExpForLevel(t){return t<=1?0:t>this.MAX_LEVEL?1/0:this.BASE_EXP+(t-2)*20}getExpForNextLevel(){return this.getExpForLevel(this.character.level+1)}getExpProgress(){if(this.character.level>=this.MAX_LEVEL)return 100;let t=this.getExpForLevel(this.character.level),e=this.getExpForNextLevel();return Math.min(100,(this.character.exp-t)/(e-t)*100)}getExpToNextLevel(){return this.character.level>=this.MAX_LEVEL?0:this.getExpForNextLevel()-this.character.exp}canLevelUp(){return this.character.level<this.MAX_LEVEL&&this.character.exp>=this.getExpForNextLevel()}addExp(t){if(this.character.level>=this.MAX_LEVEL)return null;this.character.exp+=t;let e=0,s={HP:0,ATK:0,DEF:0,SPD:0,MP:0};for(;this.canLevelUp()&&(this.character.level+=1,e+=1,this.applyStatGrowth(s),!(this.character.level>=this.MAX_LEVEL)););return 0===e?null:(this.character.currentHP=this.character.stats.HP,this.character.currentMP=this.character.stats.MP,{levelsGained:e,newLevel:this.character.level,statsGained:s,maxHPIncreased:s.HP||0,maxMPIncreased:s.MP||0})}applyStatGrowth(t){this.character.stats.HP+=this.statGrowth.HP,this.character.stats.ATK+=this.statGrowth.ATK,this.character.stats.DEF+=this.statGrowth.DEF,this.character.stats.SPD+=this.statGrowth.SPD,this.character.stats.MP+=this.statGrowth.MP,t.HP=(t.HP||0)+this.statGrowth.HP,t.ATK=(t.ATK||0)+this.statGrowth.ATK,t.DEF=(t.DEF||0)+this.statGrowth.DEF,t.SPD=(t.SPD||0)+this.statGrowth.SPD,t.MP=(t.MP||0)+this.statGrowth.MP}getLevel(){return this.character.level}getExp(){return this.character.exp}setLevel(t){if(t<1||t>this.MAX_LEVEL)throw Error("Level must be between 1 and ".concat(this.MAX_LEVEL));let e=t-this.character.level;if(0!==e){for(let t=0;t<Math.abs(e);t++)e>0?(this.character.stats.HP+=this.statGrowth.HP,this.character.stats.ATK+=this.statGrowth.ATK,this.character.stats.DEF+=this.statGrowth.DEF,this.character.stats.SPD+=this.statGrowth.SPD,this.character.stats.MP+=this.statGrowth.MP):(this.character.stats.HP-=this.statGrowth.HP,this.character.stats.ATK-=this.statGrowth.ATK,this.character.stats.DEF-=this.statGrowth.DEF,this.character.stats.SPD-=this.statGrowth.SPD,this.character.stats.MP-=this.statGrowth.MP);this.character.level=t,this.character.exp=this.getExpForLevel(t),this.character.currentHP=this.character.stats.HP,this.character.currentMP=this.character.stats.MP}}getMaxLevel(){return this.MAX_LEVEL}isMaxLevel(){return this.character.level>=this.MAX_LEVEL}getStatGrowth(){return{...this.statGrowth}}getLevelInfo(){return{level:this.character.level,exp:this.character.exp,expForNextLevel:this.getExpForNextLevel(),expToNextLevel:this.getExpToNextLevel(),progress:this.getExpProgress(),isMaxLevel:this.isMaxLevel()}}constructor(t,e){this.BASE_EXP=100,this.EXP_EXPONENT=1.5,this.MAX_LEVEL=20,this.character=t,this.statGrowth=e}}class T{registerItem(t){this.itemDatabase.set(t.id,t)}registerItems(t){t.forEach(t=>this.registerItem(t))}getItemById(t){return this.itemDatabase.get(t)||null}addItem(t){return!(this.character.inventory.length>=99)&&(this.character.inventory.push(t),!0)}removeItem(t){let e=this.character.inventory.findIndex(e=>e.id===t);return -1!==e&&(this.character.inventory.splice(e,1),!0)}removeItemAt(t){if(t<0||t>=this.character.inventory.length)return null;let e=this.character.inventory[t];return this.character.inventory.splice(t,1),e}countItem(t){return this.character.inventory.filter(e=>e.id===t).length}hasItem(t){return this.character.inventory.some(e=>e.id===t)}getInventoryInfo(){return{used:this.character.inventory.length,max:99}}equipWeapon(t){return"weapon"===t.type&&(this.character.equipment.weapon&&this.addItem(this.character.equipment.weapon),this.removeItem(t.id),this.character.equipment.weapon=t,this.applyEquipmentBonus(t),!0)}equipArmor(t){return"armor"===t.type&&(this.character.equipment.armor&&this.addItem(this.character.equipment.armor),this.removeItem(t.id),this.character.equipment.armor=t,this.applyEquipmentBonus(t),!0)}equipAccessory(t){return"accessory"===t.type&&(this.character.equipment.accessory&&this.addItem(this.character.equipment.accessory),this.removeItem(t.id),this.character.equipment.accessory=t,this.applyEquipmentBonus(t),!0)}unequipSlot(t){let e=this.character.equipment[t];return!!e&&!!this.addItem(e)&&(this.removeEquipmentBonus(e),this.character.equipment[t]=void 0,!0)}applyEquipmentBonus(t){t.statBonus&&(t.statBonus.HP&&(this.character.stats.HP+=t.statBonus.HP),t.statBonus.ATK&&(this.character.stats.ATK+=t.statBonus.ATK),t.statBonus.DEF&&(this.character.stats.DEF+=t.statBonus.DEF),t.statBonus.SPD&&(this.character.stats.SPD+=t.statBonus.SPD),t.statBonus.MP&&(this.character.stats.MP+=t.statBonus.MP))}removeEquipmentBonus(t){t.statBonus&&(t.statBonus.HP&&(this.character.stats.HP-=t.statBonus.HP),t.statBonus.ATK&&(this.character.stats.ATK-=t.statBonus.ATK),t.statBonus.DEF&&(this.character.stats.DEF-=t.statBonus.DEF),t.statBonus.SPD&&(this.character.stats.SPD-=t.statBonus.SPD),t.statBonus.MP&&(this.character.stats.MP-=t.statBonus.MP))}useItem(t){if("consumable"!==t.type)return{success:!1,message:"This item cannot be used"};let e=0,s=0;if(t.effects)for(let i of t.effects)"heal"===i.type&&("MP"===i.stat?(s=i.value,this.character.currentMP=Math.min(this.character.stats.MP,this.character.currentMP+i.value)):(e=i.value,this.character.currentHP=Math.min(this.character.stats.HP,this.character.currentHP+i.value)));return this.removeItem(t.id),{success:!0,message:"Used ".concat(t.name),hpRestored:e,mpRestored:s,itemConsumed:!0}}rollLoot(t){let e=[];for(let s of t.items)if(100*Math.random()<=s.dropRate){let t=this.getItemById(s.itemId);t&&e.push(t)}return{items:e,exp:t.exp,gold:t.gold}}collectDrops(t){let e=[],s=[];for(let i of t.items)this.addItem(i)?e.push(i):s.push(i);return{collected:e,overflow:s}}sortInventory(){let t={weapon:1,armor:2,accessory:3,consumable:4},e={epic:1,rare:2,common:3};this.character.inventory.sort((s,i)=>{let a=t[s.type]-t[i.type];if(0!==a)return a;let r=e[s.rarity]-e[i.rarity];return 0!==r?r:s.name.localeCompare(i.name)})}getItemsByType(t){return this.character.inventory.filter(e=>e.type===t)}getInventoryValue(){return this.character.inventory.reduce((t,e)=>t+e.price,0)}constructor(t){this.itemDatabase=new Map,this.character=t}}class D extends n().Scene{init(t){console.log("EndingScene initialized with:",t),this.endingData=t}create(){var t;if(!this.endingData)return void console.error("No ending data provided");let{width:e,height:s}=this.cameras.main,i=this.getEndingContent(this.endingData.endingType);this.add.rectangle(e/2,s/2,e,s,parseInt(i.color.replace("#","0x"),16),.2),this.titleText=this.add.text(e/2,100,i.title,{fontSize:"48px",color:i.color,fontStyle:"bold",align:"center"}).setOrigin(.5),this.add.text(e/2,160,i.subtitle,{fontSize:"24px",color:"#d4d4d4",align:"center"}).setOrigin(.5);let a=i.story.join("\n\n");this.storyText=this.add.text(e/2,220,a,{fontSize:"18px",color:"#d4d4d4",align:"center",wordWrap:{width:e-100},lineSpacing:10}).setOrigin(.5,0);let r=s-200,n=this.formatStatistics(this.endingData);this.statsText=this.add.text(e/2,r,n,{fontSize:"16px",color:"#888888",align:"center",lineSpacing:8}).setOrigin(.5);let l=this.getEndingBadge(this.endingData.endingType);this.add.text(e/2,r-80,l,{fontSize:"32px",color:i.color,align:"center"}).setOrigin(.5),this.add.text(e/2,s-60,"Press SPACE to return to main menu",{fontSize:"16px",color:"#666666",align:"center"}).setOrigin(.5),null==(t=this.input.keyboard)||t.once("keydown-SPACE",()=>{this.scene.start("ClassSelectScene")}),console.log("Ending: ".concat(this.endingData.endingType," - Tech Debt: ").concat(this.endingData.techDebt))}getEndingContent(t){switch(t){case"good":return{title:"✨ GOOD ENDING ✨",subtitle:"Clean Code Champion",story:["Your code is pristine, your architecture sound.","The bugs have been vanquished, and the codebase shines.","Senior developers nod in approval as they review your work.",'You\'ve earned the title of "Code Quality Guardian".',"","The project ships on time with zero critical bugs.","Your team celebrates with cake and high-fives."],color:"#4ec9b0"};case"normal":return{title:"\uD83D\uDC4D NORMAL ENDING",subtitle:"Decent Developer",story:["The bugs are fixed, but some technical debt remains.","It's not perfect, but it works well enough.","The PM accepts the deliverable with minor reservations.","You've done your job competently.","","The project ships with a few known issues.",'"We\'ll refactor it in the next sprint," they say.',"(They never do.)"],color:"#dcdcaa"};case"bad":return{title:"\uD83D\uDC80 BAD ENDING",subtitle:"Technical Debt Disaster",story:["The bugs are gone, but at what cost?","Your code is a tangled mess of quick fixes.","The tech debt has spiraled out of control.","Maintenance will be a nightmare.","","The project ships, but crashes within a week.","You spend the next month firefighting.","The PM is... not pleased."],color:"#f48771"};case"secret":return{title:"\uD83C\uDF8A SECRET ENDING \uD83C\uDF8A",subtitle:"Perfect Code Deity",story:["\uD83C\uDF1F LEGENDARY ACHIEVEMENT UNLOCKED \uD83C\uDF1F","","Zero bugs. Zero tech debt. Zero compromises.","You've achieved what many thought impossible.","Your code is so clean it could be taught in universities.","","The CTO personally offers you a senior architect position.","Other developers ask you to mentor them.","Your GitHub profile becomes a shrine.","","You are the embodiment of clean code principles."],color:"#c586c0"}}}getEndingBadge(t){switch(t){case"good":return"\uD83C\uDFC6 CLEAN CODE CHAMPION";case"normal":return"⚙️ WORKING AS INTENDED";case"bad":return"\uD83D\uDD25 TECHNICAL DEBT ACQUIRED";case"secret":return"\uD83D\uDC51 LEGENDARY DEVELOPER"}}formatStatistics(t){let e=Math.floor(t.playTime/3600),s=Math.floor(t.playTime%3600/60),i=e>0?"".concat(e,"h ").concat(s,"m"):"".concat(s,"m");return["═══════════════════════════════════════\nFINAL STATISTICS\n═══════════════════════════════════════","Tech Debt: ".concat(t.techDebt,"/100"),"Bugs Defeated: ".concat(t.totalDefeated),"Final Level: ".concat(t.finalLevel),"Chapters Completed: ".concat(t.chapter),"Play Time: ".concat(i),"═══════════════════════════════════════"].join("\n")}static determineEnding(t,e,s){return 0===t&&e&&s?"secret":t<=39?"good":t<=70?"normal":"bad"}static getEndingDescription(t){switch(t){case"good":return"Tech Debt 0-39: Clean Code Champion";case"normal":return"Tech Debt 40-70: Decent Developer";case"bad":return"Tech Debt 71-100: Technical Debt Disaster";case"secret":return"Tech Debt 0 + Perfect Run: Legendary Developer"}}constructor(){super({key:"EndingScene"}),this.endingData=null,this.titleText=null,this.storyText=null,this.statsText=null}}let E=JSON.parse('{"A":[{"id":"marketing-promo","name":"Marketing Promo Rush","description":"The marketing team launched a surprise promotion! Server traffic surges.","icon":"\uD83D\uDCE2","chapter":1,"probability":10,"effects":[{"type":"buff","stat":"ATK","value":20,"duration":3,"target":"player"}],"resultText":"Adrenaline rush! ATK +20% for 3 turns"},{"id":"night-deploy","name":"Night Deploy","description":"Someone deployed to production at 3 AM. Things are breaking.","icon":"\uD83C\uDF19","chapter":2,"probability":5,"effects":[{"type":"damage","stat":"HP","value":10,"target":"player"}],"resultText":"Lost 10% HP from the stress!"},{"id":"merge-conflict","name":"Merge Conflict Hell","description":"A massive merge conflict appeared. This will take time...","icon":"⚠️","chapter":2,"probability":7,"effects":[{"type":"debuff","stat":"SPD","value":20,"duration":2,"target":"player"}],"resultText":"Slowed down by conflicts. SPD -20% for 2 turns"},{"id":"mentor-help","name":"Mentor\'s Wisdom","description":"Your mentor shared valuable debugging techniques!","icon":"\uD83C\uDF93","chapter":2,"probability":6,"effects":[{"type":"buff","stat":"ATK","value":15,"duration":4,"target":"player"},{"type":"buff","stat":"DEF","value":10,"duration":4,"target":"player"}],"resultText":"Learned new skills! ATK +15%, DEF +10% for 4 turns"},{"id":"code-review-quiz","name":"Code Review Quiz","description":"A senior dev quizzes you: \\"What\'s the time complexity of binary search?\\"","icon":"\uD83D\uDCDD","chapter":1,"probability":15,"effects":[],"resultText":"","choices":[{"id":"correct-ologn","text":"O(log n)","effects":[{"type":"exp","value":50,"target":"player"}],"resultText":"Correct! The senior dev is impressed. +50 EXP!"},{"id":"wrong-on","text":"O(n)","effects":[{"type":"techDebt","value":5}],"resultText":"Wrong... that\'s linear search. +5 Tech Debt"},{"id":"wrong-on2","text":"O(n\xb2)","effects":[{"type":"techDebt","value":5}],"resultText":"Wrong... that\'s bubble sort territory. +5 Tech Debt"}]},{"id":"coffee-break-choice","name":"Coffee Break","description":"The break room has two options. What do you grab?","icon":"☕","chapter":1,"probability":12,"effects":[],"resultText":"","choices":[{"id":"regular-coffee","text":"Regular Coffee","effects":[{"type":"heal","stat":"HP","value":50,"target":"player"}],"resultText":"A warm cup of coffee. Recovered 50% HP!"},{"id":"energy-drink","text":"Energy Drink","effects":[{"type":"heal","stat":"HP","value":30,"target":"player"},{"type":"gold","value":1.25,"multiplier":true}],"resultText":"Buzzing with energy! +30% HP and next battle gold x1.25!"}]},{"id":"stackoverflow-search","name":"Stack Overflow Search","description":"You search: \\"TypeError: undefined is not a function\\". Which answer looks right?","icon":"\uD83D\uDCA1","chapter":1,"probability":8,"effects":[],"resultText":"","choices":[{"id":"accepted-answer","text":"Check if the function exists before calling it","effects":[{"type":"gold","value":1.5,"multiplier":true},{"type":"heal","stat":"HP","value":20,"target":"player"}],"resultText":"The accepted answer works! +20% HP, next gold x1.5!"},{"id":"bad-answer-1","text":"Just wrap everything in try-catch","effects":[{"type":"techDebt","value":3}],"resultText":"That just hides the bug... +3 Tech Debt"},{"id":"bad-answer-2","text":"Downgrade to an older version","effects":[{"type":"techDebt","value":3}],"resultText":"That introduces security vulnerabilities! +3 Tech Debt"}]},{"id":"legacy-code-dilemma","name":"Legacy Code Dilemma","description":"You found a 2000-line function with no tests. What do you do?","icon":"\uD83D\uDCDC","chapter":2,"probability":10,"effects":[],"resultText":"","choices":[{"id":"refactor","text":"Refactor It","effects":[{"type":"techDebt","value":-10},{"type":"damage","stat":"HP","value":20,"target":"player"}],"resultText":"Hard work pays off! -10 Tech Debt, but lost 20% HP from exhaustion."},{"id":"ignore","text":"Leave It Alone","effects":[{"type":"techDebt","value":15}],"resultText":"Out of sight, out of mind... +15 Tech Debt"}]}]}');class M{rollEvent(){if(100*Math.random()>=30)return{event:null,applied:!1};let t=this.events[Math.floor(Math.random()*this.events.length)];return t?{event:t,applied:!1}:{event:null,applied:!1}}applyEffects(t,e){let s=0,i=0,a=0,r=[],n=this.getLastEventResult();if(!n||!n.event)return{damageDealt:0,healingDone:0,techDebtChange:0,goldMultiplier:1,appliedEffects:[]};for(let l of n.event.effects)switch(l.type){case"damage":if("player"===l.target&&"HP"===l.stat){let e=Math.floor(t.maxHP*(l.value/100));t.HP=Math.max(1,t.HP-e),s=e}break;case"heal":if("player"===l.target&&"HP"===l.stat){let e=Math.floor(t.maxHP*(l.value/100));t.HP=Math.min(t.maxHP,t.HP+e),i=e}break;case"buff":case"debuff":"player"===l.target&&l.stat&&l.duration&&r.push({stat:l.stat,modifier:"buff"===l.type?l.value:-l.value,duration:l.duration,type:l.type});break;case"techDebt":a=l.value,e.current+=a;break;case"gold":l.multiplier&&(this.goldMultiplier=l.value)}return this.appliedEffects=r,{damageDealt:s,healingDone:i,techDebtChange:a,goldMultiplier:this.goldMultiplier,appliedEffects:r}}consumeGoldMultiplier(){let t=this.goldMultiplier;return this.goldMultiplier=1,t}getActiveEffects(){return[...this.appliedEffects]}decrementEffectDurations(){this.appliedEffects=this.appliedEffects.map(t=>({...t,duration:t.duration-1})).filter(t=>t.duration>0)}clearEffects(){this.appliedEffects=[],this.goldMultiplier=1}setLastEventResult(t){this.lastEventResult=t}getLastEventResult(){return this.lastEventResult}clearLastEventResult(){this.lastEventResult=null}constructor(){this.goldMultiplier=1,this.appliedEffects=[],this.lastEventResult=null,this.events=E.A}}class I extends n().Scene{init(t){var e,s,i;console.log("BattleScene initialized with:",t),this.sceneData=t,this.focusBuff=!1,this.activeBuffs=[],this.statusEffects=[],this.isPlayerTurn=!0,this.battleStartTime=Date.now(),this.skillPanelVisible=!1,this.actionButtons=[],this.stagesCompleted=null!=(e=t.stagesCompleted)?e:[],this.progressionSystem=null!=(s=t.progression)?s:new h,this.techDebt=new P(null!=(i=t.techDebtCarry)?i:0),t.player?this.player=t.player:this.player=x(t.playerClass.toLowerCase(),"Hero",1);let a=b.getClass(t.playerClass.toLowerCase());a&&this.player&&(this.levelUpSystem=new C(this.player,a.statGrowth)),this.player&&(this.itemSystem=new T(this.player),this.itemSystem.registerItems(b.getAllItems())),this.monster=this.selectMonsterForStage(t.chapter,t.stage),this.monster&&(this.enemyAI=new k(this.monster))}create(){var t,e,s,i,a,r,n;let l=this.cameras.main.width,o=this.cameras.main.height;this.add.rectangle(l/2,o/2,l,o,1973790);let c=null!=(a=null==(t=this.sceneData)?void 0:t.chapter)?a:1,h=null!=(r=null==(e=this.sceneData)?void 0:e.stage)?r:1;this.stageText=this.add.text(l/2,20,"Chapter ".concat(c," - Stage ").concat(h),{fontSize:"16px",color:"#858585"}).setOrigin(.5),this.add.text(l/2,50,"Bug Slayer - Battle",{fontSize:"32px",color:"#4a90e2"}).setOrigin(.5),this.add.text(100,150,"Player",{fontSize:"24px",color:"#ffffff"}),this.playerHPText=this.add.text(100,200,"",{fontSize:"18px",color:"#4ade80"}),this.add.text(80,225,"❤",{fontSize:"14px",color:"#4ec9b0"}),this.add.text(80,245,"◆",{fontSize:"14px",color:"#569cd6"});let d=null!=(n=null==(s=this.sceneData)?void 0:s.playerClass.toLowerCase())?n:"debugger",u="character-".concat(d);this.textures.exists(u)?this.add.image(150,300,u).setOrigin(.5,.5):this.add.rectangle(150,300,64,64,4886754),this.add.text(l-200,150,"Bug",{fontSize:"24px",color:"#ffffff"}),this.monsterHPText=this.add.text(l-200,200,"",{fontSize:"18px",color:"#ef4444"});let p=this.getMonsterTexture();p&&this.textures.exists(p)?this.bossSprite=this.add.image(l-150,300,p).setOrigin(.5,.5):this.bossSprite=this.add.rectangle(l-150,300,64,64,0xef4444),(null==(i=this.monster)?void 0:i.type)==="warning"&&this.bossSprite&&(this.bossSprite.fillColor=0xdcdcaa),this.bossPhaseOverlay=this.add.rectangle(l/2,o/2,l,o,0,0).setDepth(10),this.bossDialogueText=this.add.text(l/2,420,"",{fontSize:"20px",color:"#ffffff",backgroundColor:"#1a1a2e",padding:{x:15,y:10},align:"center",fontStyle:"bold"}).setOrigin(.5).setDepth(20).setVisible(!1),this.buffText=this.add.text(l/2,380,"",{fontSize:"14px",color:"#c586c0",align:"center"}).setOrigin(.5),this.statusEffectText=this.add.text(l/2,400,"",{fontSize:"14px",color:"#f48771",align:"center"}).setOrigin(.5),this.add.text(l/2,o-280,"Tech Debt",{fontSize:"16px",color:"#858585"}).setOrigin(.5);let f=l/2-150,g=o-250;this.add.rectangle(f+150,g+10,300,20,2763306).setOrigin(.5),this.techDebtBar=this.add.graphics(),this.techDebtText=this.add.text(l/2,g+20+15,"",{fontSize:"14px",color:"#ffffff"}).setOrigin(.5),this.turnText=this.add.text(l/2,o-200,"",{fontSize:"20px",color:"#ffffff",align:"center",wordWrap:{width:l-40}}).setOrigin(.5);let m=o-140,y=o-90,b=t=>({fontSize:"16px",color:"#ffffff",backgroundColor:t,padding:{x:12,y:8}}),x=this.add.text(l/2-120,m,"⚔ Attack",b("#4a90e2")).setOrigin(.5).setInteractive(),S=this.add.text(l/2,m,"⭐ Skills",b("#e5c07b")).setOrigin(.5).setInteractive(),v=this.add.text(l/2+120,m,"\uD83E\uDDED Item",b("#4ade80")).setOrigin(.5).setInteractive(),P=this.add.text(l/2-80,y,"\uD83D\uDEE1 Focus",b("#9333ea")).setOrigin(.5).setInteractive(),w=this.add.text(l/2+80,y,"\uD83C\uDFC3 Flee",b("#f59e0b")).setOrigin(.5).setInteractive();x.on("pointerdown",()=>this.handleAttack()),S.on("pointerdown",()=>this.toggleSkillPanel()),v.on("pointerdown",()=>this.handleItemUse()),P.on("pointerdown",()=>this.handleFocus()),w.on("pointerdown",()=>this.handleFlee()),this.actionButtons=[x,S,v,P,w],this.createSkillPanel(),this.updateUI()}getMonsterTexture(){if(!this.monster)return null;let t=this.monster.id.toLowerCase();if("boss"===this.monster.type)return t.includes("heisenbug")||t.includes("finalcompiler")?"bug-".concat(t):"bug-boss-generic";let e=t.replace("bug-","").replace(/\d+/g,""),s="bug-".concat(e);if(this.textures.exists(s))return s;for(let e of["nullpointer","stackoverflow","racecondition","memoryleak","deadlock","offbyone","sqlinjection","xss","bufferoverflow","infiniteloop","heisenbug"])if(t.includes(e)||this.monster.name.toLowerCase().includes(e))return"bug-".concat(e);return"bug-nullpointer"}selectMonsterForStage(t,e){if(e===(1===t?6:5)){let e=b.getBossForChapter(t);return e?this.createMonsterFromData(e):(console.error("Boss not found for chapter ".concat(t)),this.createMockMonster())}let s=b.getBugsForChapter(t).filter(t=>"bug"===t.type),i=e-1;return i>=0&&i<s.length?this.createMonsterFromData(s[i]):(console.error("Bug not found for chapter ".concat(t,", stage ").concat(e)),this.createMockMonster())}createMonsterFromData(t){return{id:t.id,name:t.name,type:t.type,chapter:t.chapter,stats:t.stats,currentHP:t.stats.HP,phase:t.phase,behaviorTree:t.behaviorTree,drops:t.drops,techDebtOnSkip:t.techDebtOnSkip}}createMockMonster(){return{id:"bug-001",name:"NullPointerException",type:"bug",chapter:1,stats:{HP:80,ATK:12,DEF:5,SPD:10},currentHP:80,behaviorTree:{conditions:[],actions:[{type:"attack",weight:100}]},drops:{items:[],exp:50,gold:20},techDebtOnSkip:10}}createSkillPanel(){var t,e;if(!this.player)return;let s=this.cameras.main.width,i=this.cameras.main.height;this.skillPanelContainer=this.add.container(s/2,i/2),this.skillPanelContainer.setVisible(!1);let a=this.add.rectangle(0,0,500,320,1710638,.95);a.setStrokeStyle(2,4886754),this.skillPanelContainer.add(a);let r=this.add.text(0,-140,"Skills",{fontSize:"22px",color:"#4a90e2",fontStyle:"bold"}).setOrigin(.5);this.skillPanelContainer.add(r);let n=this.add.text(220,-140,"X",{fontSize:"18px",color:"#ef4444",backgroundColor:"#2a2a2a",padding:{x:8,y:4}}).setOrigin(.5).setInteractive();n.on("pointerdown",()=>this.toggleSkillPanel()),this.skillPanelContainer.add(n);let l=null!=(e=null==(t=this.sceneData)?void 0:t.playerClass.toLowerCase())?e:"",o=b.getSkillsForClass(l),c=this.player.level,h=[1,1,5,5,10,10,15,15],d=o.filter((t,e)=>{var s;return c>=(null!=(s=h[e])?s:1)});d.forEach((t,e)=>{var s;let i=-100+35*e;if(i>140)return;let a=this.player.currentMP>=t.mpCost,r=null!=(s=this.skillCooldowns.get(t.id))?s:0,n=r>0,l=a&&!n,o=this.add.text(0,i,"".concat(t.name," (").concat(t.mpCost," MP)").concat(n?" [CD: ".concat(r,"t]"):""," - ").concat(t.description),{fontSize:"13px",color:l?"#ffffff":"#666666",backgroundColor:l?"#2a4a6a":"#1a1a2a",padding:{x:10,y:5},wordWrap:{width:460}}).setOrigin(.5);l&&(o.setInteractive(),o.on("pointerdown",()=>{this.toggleSkillPanel(),this.handleSkillUse(t)}),o.on("pointerover",()=>o.setBackgroundColor("#3a5a8a")),o.on("pointerout",()=>o.setBackgroundColor("#2a4a6a"))),this.skillPanelContainer.add(o)});let u=o.length-d.length;if(u>0){let t=this.add.text(0,-100+35*d.length+10,"".concat(u," skill(s) locked (higher level required)"),{fontSize:"12px",color:"#666666"}).setOrigin(.5);this.skillPanelContainer.add(t)}}toggleSkillPanel(){this.skillPanelContainer&&(this.skillPanelVisible=!this.skillPanelVisible,this.skillPanelContainer.setVisible(this.skillPanelVisible),this.skillPanelVisible&&this.rebuildSkillPanel())}rebuildSkillPanel(){this.skillPanelContainer&&this.player&&(this.skillPanelContainer.removeAll(!0),this.skillPanelContainer.setVisible(!1),this.skillPanelContainer.destroy(),this.createSkillPanel(),this.skillPanelContainer.setVisible(!0),this.skillPanelVisible=!0)}setActionsEnabled(t){this.actionButtons.forEach(e=>{t?(e.setInteractive(),e.setAlpha(1)):(e.disableInteractive(),e.setAlpha(.5))})}handleAttack(){var t,e,s,i;if(!this.player||!this.monster||!this.techDebt||!this.isPlayerTurn)return;if(this.isPlayerTurn=!1,this.setActionsEnabled(!1),this.skillPanelVisible&&this.toggleSkillPanel(),this.hasStatusEffect("confusion","player")&&.5>Math.random()){let t=Math.floor(.5*this.player.stats.ATK);return(this.player.currentHP=Math.max(0,this.player.currentHP-t),this.techDebt.turnPassed(),this.autoRestoreMP(),null==(e=this.turnText)||e.setText("CONFUSED! You hit yourself for ".concat(t," damage!")),this.updateUI(),this.player.currentHP<=0)?void this.time.delayedCall(1e3,()=>this.handleDefeat()):void this.time.delayedCall(1e3,()=>this.monsterTurn())}let a=this.getEffectiveStat(this.player.stats.ATK,"ATK","player");this.focusBuff&&(a=Math.floor(1.2*a),this.focusBuff=!1);let r=null!=(s=this.monster.stats.SPD)?s:0,n=this.getEffectiveStat(this.player.stats.SPD,"SPD","player");if(this.rollEvasion(r,n)){this.techDebt.turnPassed(),this.autoRestoreMP(),null==(i=this.turnText)||i.setText("".concat(this.monster.name," evaded! MISS!")),this.updateUI(),this.time.delayedCall(1e3,()=>this.monsterTurn());return}let l=this.getEffectiveStat(this.monster.stats.DEF,"DEF","monster"),o=this.calculateDamage(a,l),c=this.rollCritical(n,r),h="";c&&(o=Math.floor(1.5*o),h=" CRITICAL HIT!");let d=!1===this.focusBuff&&a!==this.player.stats.ATK?" +20% Focus Bonus!":"",u=this.applyPassiveToOutgoingDamage(o);o=u.damage,this.monster.currentHP=Math.max(0,this.monster.currentHP-o),this.techDebt.turnPassed();let p=this.autoRestoreMP();if(null==(t=this.turnText)||t.setText("You dealt ".concat(o," damage!").concat(h).concat(d).concat(u.text,"\n(+").concat(p," MP, +1 Tech Debt)")),this.updateUI(),this.monster.currentHP<=0)return void this.time.delayedCall(1e3,()=>this.handleVictory());this.time.delayedCall(1e3,()=>this.monsterTurn())}handleSkillUse(t){var e,s,i,a,r,n;if(!this.player||!this.monster||!this.techDebt||!this.isPlayerTurn)return;if(this.player.currentMP<t.mpCost){null==(s=this.turnText)||s.setText("Not enough MP!");return}let l=null!=(i=this.skillCooldowns.get(t.id))?i:0;if(l>0){null==(a=this.turnText)||a.setText("".concat(t.name," is on cooldown! (").concat(l," turns)"));return}this.isPlayerTurn=!1,this.setActionsEnabled(!1),this.player.currentMP-=t.mpCost,t.cooldown>0&&this.skillCooldowns.set(t.id,t.cooldown);let o=0,c=0,h=[];for(let e of t.effects)switch(e.type){case"damage":{let t=Math.floor(this.getEffectiveStat(this.player.stats.ATK,"ATK","player")*(e.value/100));this.focusBuff&&(t=Math.floor(1.2*t),h.push("+20% Focus Bonus!"),this.focusBuff=!1);let s=null!=(r=this.monster.stats.SPD)?r:0,i=this.getEffectiveStat(this.player.stats.SPD,"SPD","player");if(this.rollEvasion(s,i)){h.push("MISS!");break}let a=this.getEffectiveStat(this.monster.stats.DEF,"DEF","monster"),n=this.calculateDamage(t,a);this.rollCritical(i,s)&&(n=Math.floor(1.5*n),h.push("CRITICAL!")),this.monster.currentHP=Math.max(0,this.monster.currentHP-n),o+=n;break}case"heal":{let t=Math.floor(this.player.stats.HP*(e.value/100));this.player.currentHP=Math.min(this.player.stats.HP,this.player.currentHP+t),c+=t,h.push("Healed ".concat(t," HP"));break}case"buff":e.stat&&e.duration&&(this.activeBuffs.push({stat:e.stat,value:e.value,turnsRemaining:e.duration,target:(t.targetType,"player")}),h.push("+".concat(e.value," ").concat(e.stat," for ").concat(e.duration," turns")));break;case"debuff":e.stat&&e.duration&&(this.activeBuffs.push({stat:e.stat,value:e.value,turnsRemaining:e.duration,target:"monster"}),h.push("".concat(e.value," ").concat(e.stat," on enemy for ").concat(e.duration," turns")));break;case"special":if((null==(n=e.description)?void 0:n.includes("Tech Debt"))&&this.techDebt){let t=Math.abs(e.value);this.techDebt.decrease(t),h.push("Tech Debt reduced by ".concat(t,"!"))}break;case"dot":e.duration&&(this.activeBuffs.push({stat:"DOT",value:e.value,turnsRemaining:e.duration,target:"monster"}),h.push("DoT: ".concat(e.value," dmg/turn for ").concat(e.duration," turns")))}this.techDebt.turnPassed();let d=this.autoRestoreMP(),u="Used ".concat(t.name,"!");if(o>0&&(u+=" ".concat(o," damage!")),c>0&&(u+=" Restored ".concat(c," HP!")),h.length>0&&(u+="\n".concat(h.join(" | "))),u+="\n(+".concat(d," MP, +1 Tech Debt)"),null==(e=this.turnText)||e.setText(u),this.updateUI(),this.monster.currentHP<=0)return void this.time.delayedCall(1e3,()=>this.handleVictory());this.time.delayedCall(1e3,()=>this.monsterTurn())}handleFocus(){var t;if(!this.player||!this.monster||!this.techDebt||!this.isPlayerTurn)return;this.isPlayerTurn=!1,this.setActionsEnabled(!1),this.skillPanelVisible&&this.toggleSkillPanel();let e=Math.floor(.15*this.player.stats.MP);this.player.currentMP=Math.min(this.player.stats.MP,this.player.currentMP+e),this.focusBuff=!0,this.techDebt.turnPassed(),null==(t=this.turnText)||t.setText("You focused! Restored ".concat(e," MP.\nNext attack deals +20% damage! (+1 Tech Debt)")),this.updateUI(),this.time.delayedCall(1e3,()=>this.monsterTurn())}handleFlee(){var t;if(!this.player||!this.monster||!this.techDebt||!this.isPlayerTurn)return;this.isPlayerTurn=!1,this.setActionsEnabled(!1),this.skillPanelVisible&&this.toggleSkillPanel();let e=this.techDebt.flee();null==(t=this.turnText)||t.setText("You fled from battle! (+".concat(e," Tech Debt)")),this.updateUI(),this.time.delayedCall(2e3,()=>{this.advanceToNextStage(!1)})}triggerMinigame(){if(!this.monster||!this.enemyAI)return;this.minigameActive=!0;let t=this.enemyAI.phase;this.scene.launch("MinigameScene",{returnScene:"BattleScene",difficulty:t}),this.scene.pause(),this.scene.get("MinigameScene").events.once("shutdown",()=>{this.handleMinigameResult()})}handleMinigameResult(){var t,e;if(this.monster&&this.player){if(this.minigameActive=!1,this.scene.get("MinigameScene").data.get("onSuccess")){let e=Math.floor(.3*this.monster.stats.HP);if(this.monster.currentHP=Math.max(0,this.monster.currentHP-e),null==(t=this.turnText)||t.setText("Shield Break! ".concat(e," damage to ").concat(this.monster.name,"!")),this.monster.currentHP<=0){this.updateUI(),this.time.delayedCall(1500,()=>this.handleVictory());return}}else{let t=Math.floor(.1*this.monster.stats.HP);this.monster.currentHP=Math.min(this.monster.stats.HP,this.monster.currentHP+t),null==(e=this.turnText)||e.setText("".concat(this.monster.name," heals ").concat(t," HP!"))}this.updateUI(),this.time.delayedCall(1500,()=>{if(this.enemyAI){let t=this.enemyAI.decideAction();this.executeEnemyAction(t)}})}}monsterTurn(){if(!this.player||!this.monster||!this.techDebt||!this.enemyAI)return;if(this.tickStatusEffects("monster"),this.hasStatusEffect("stun","monster")){var t;null==(t=this.turnText)||t.setText("".concat(this.monster.name," is STUNNED! Turn skipped!")),this.updateUI(),this.time.delayedCall(1500,()=>{var t,e;if(this.tickStatusEffects("player"),this.hasStatusEffect("stun","player")){null==(e=this.turnText)||e.setText("You are STUNNED! Turn skipped!"),this.updateUI(),this.time.delayedCall(1500,()=>this.monsterTurn());return}this.isPlayerTurn=!0,this.setActionsEnabled(!0),this.tickCooldowns();let s=this.hasStatusEffect("confusion","player")?" [CONFUSED]":"";null==(t=this.turnText)||t.setText("Your turn! Choose an action.".concat(s))});return}if(this.tickBuffs(),this.applyDoTEffects(),this.monster.currentHP<=0)return void this.time.delayedCall(500,()=>this.handleVictory());let e=this.enemyAI.decideAction(),s="boss"===this.monster.type,i=this.enemyAI.phase;s&&i>this.lastBossPhase?(this.lastBossPhase=i,this.applyBossPhaseVisuals(i),this.time.delayedCall(2500,()=>{this.triggerMinigame()})):this.executeEnemyAction(e)}executeEnemyAction(t){var e,s,i,a;if(!this.player||!this.monster||!this.techDebt)return;if(this.hasStatusEffect("confusion","monster")&&("attack"===t.type||"skill"===t.type)&&.5>Math.random()){let t=Math.floor(.5*this.monster.stats.ATK);return(this.monster.currentHP=Math.max(0,this.monster.currentHP-t),null==(s=this.turnText)||s.setText("".concat(this.monster.name," is CONFUSED! Hit itself for ").concat(t," damage!")),this.updateUI(),this.monster.currentHP<=0)?void this.time.delayedCall(1e3,()=>this.handleVictory()):void this.time.delayedCall(1500,()=>{var t;this.isPlayerTurn=!0,this.setActionsEnabled(!0),this.tickCooldowns(),null==(t=this.turnText)||t.setText("Your turn! Choose an action.")})}let r=this.techDebt.enemyAtkModifier,n="";switch(t.type){case"attack":{let t=Math.floor(this.monster.stats.ATK*r),e=this.getEffectiveStat(t,"ATK","monster"),s=this.getEffectiveStat(this.player.stats.DEF,"DEF","player"),a=this.getEffectiveStat(this.player.stats.SPD,"SPD","player"),l=null!=(i=this.monster.stats.SPD)?i:0;if(this.rollEvasion(a,l)){n="".concat(this.monster.name," attacked but you evaded! MISS!");break}let o=this.calculateDamage(e,s),c="";this.rollCritical(l,a)&&(o=Math.floor(1.5*o),c=" CRITICAL HIT!");let h=this.applyPassiveToIncomingDamage(o);o=h.damage,n="".concat(this.monster.name," attacked!").concat(c," ").concat(o," damage").concat(h.text)+(1!==r?" (".concat(Math.round((r-1)*100),"% from Tech Debt)"):""),this.player.currentHP=Math.max(0,this.player.currentHP-o);break}case"skill":{let e=Math.floor(Math.floor(1.5*this.monster.stats.ATK)*r),s=this.getEffectiveStat(this.player.stats.DEF,"DEF","player"),i=this.getEffectiveStat(this.player.stats.SPD,"SPD","player"),l=null!=(a=this.monster.stats.SPD)?a:0;if(this.rollEvasion(i,l)){n="".concat(this.monster.name," used ").concat(t.skillId," but you evaded! MISS!");break}let o=this.calculateDamage(e,s),c="";this.rollCritical(l,i)&&(o=Math.floor(1.5*o),c=" CRITICAL!");let h=this.applyPassiveToIncomingDamage(o);o=h.damage,n="".concat(this.monster.name," used ").concat(t.skillId,"!").concat(c," ").concat(o," damage").concat(h.text),this.player.currentHP=Math.max(0,this.player.currentHP-o),"boundary-breach"===t.skillId?(this.applyStatusEffect("stun",1,"player"),n+=" You are STUNNED!"):"uncertainty"===t.skillId?(this.applyStatusEffect("confusion",2,"player"),n+=" You are CONFUSED!"):"observer-effect"===t.skillId&&(this.applyStatusEffect("confusion",1,"player"),n+=" You are CONFUSED!");break}case"buff":{let e=t.targetStat||"ATK";this.activeBuffs.push({stat:e,value:20,turnsRemaining:3,target:"monster"}),n="".concat(this.monster.name," buffed ").concat(e,"! (+20 for 3 turns)");break}case"heal":{let e=t.amount||Math.floor(.15*this.monster.stats.HP);this.monster.currentHP=Math.min(this.monster.stats.HP,this.monster.currentHP+e),n="".concat(this.monster.name," healed ").concat(e," HP!")}}if(null==(e=this.turnText)||e.setText(n),this.updateUI(),this.player.currentHP<=0)return void this.time.delayedCall(1e3,()=>this.handleDefeat());this.time.delayedCall(1500,()=>{var t,e;if(this.tickStatusEffects("player"),this.updateUI(),this.hasStatusEffect("stun","player")){null==(e=this.turnText)||e.setText("You are STUNNED! Turn skipped!"),this.updateUI(),this.time.delayedCall(1500,()=>this.monsterTurn());return}this.isPlayerTurn=!0,this.setActionsEnabled(!0),this.tickCooldowns();let s=this.hasStatusEffect("confusion","player")?" [CONFUSED]":"";null==(t=this.turnText)||t.setText("Your turn! Choose an action.".concat(s))})}rollCritical(t,e){return 100*Math.random()<Math.min(30,10+.5*t)}rollEvasion(t,e){return 100*Math.random()<Math.min(50,Math.max(0,(t-e)*2))}calculateDamage(t,e){return Math.max(1,Math.floor(100/(100+.7*e)*t))}getEffectiveStat(t,e,s){let i=0;for(let t of this.activeBuffs)t.stat===e&&t.target===s&&t.turnsRemaining>0&&(i+=t.value);return Math.max(0,t+i)}tickBuffs(){for(let t of this.activeBuffs)t.turnsRemaining-=1;this.activeBuffs=this.activeBuffs.filter(t=>t.turnsRemaining>0)}applyDoTEffects(){if(this.monster)for(let t of this.activeBuffs)"DOT"===t.stat&&"monster"===t.target&&t.turnsRemaining>0&&(this.monster.currentHP=Math.max(0,this.monster.currentHP-t.value))}tickCooldowns(){for(let[t,e]of this.skillCooldowns.entries())e>0&&this.skillCooldowns.set(t,e-1),e<=1&&this.skillCooldowns.delete(t)}applyStatusEffect(t,e,s){let i=this.statusEffects.find(e=>e.type===t&&e.target===s);if(i){i.turnsRemaining=Math.max(i.turnsRemaining,e);return}this.statusEffects.push({type:t,turnsRemaining:e,target:s})}hasStatusEffect(t,e){return this.statusEffects.some(s=>s.type===t&&s.target===e&&s.turnsRemaining>0)}tickStatusEffects(t){for(let e of this.statusEffects)e.target===t&&(e.turnsRemaining-=1);this.statusEffects=this.statusEffects.filter(t=>t.turnsRemaining>0)}applyPassiveToOutgoingDamage(t){if(!this.player||!this.sceneData)return{damage:t,text:""};let e=this.sceneData.playerClass.toLowerCase();switch(this.attackCount++,e){case"refactorer":if(this.attackCount%3==0)return{damage:Math.floor(1.5*t),text:" [Code Optimization: 150%!]"};break;case"fullstack":if(this.player.currentHP>.7*this.player.stats.HP)return{damage:Math.floor(1.2*t),text:" [Full Power: +20%!]"}}return{damage:t,text:""}}applyPassiveToIncomingDamage(t){return this.sceneData&&"debugger"===this.sceneData.playerClass.toLowerCase()&&.2>Math.random()?{damage:Math.floor(.5*t),text:" [Exception Handler: -50%!]"}:{damage:t,text:""}}handleItemUse(){if(!this.player||!this.techDebt||!this.isPlayerTurn||!this.itemSystem)return;this.skillPanelVisible&&this.toggleSkillPanel();let t=this.itemSystem.getItemsByType("consumable");if(0===t.length){var e;null==(e=this.turnText)||e.setText("No items to use!");return}this.showItemPanel(t)}showItemPanel(t){this.itemPanelContainer&&(this.itemPanelContainer.removeAll(!0),this.itemPanelContainer.destroy());let e=this.cameras.main.width,s=this.cameras.main.height;this.itemPanelContainer=this.add.container(e/2,s/2);let i=this.add.rectangle(0,0,400,250,1710638,.95);i.setStrokeStyle(2,4906624),this.itemPanelContainer.add(i);let a=this.add.text(0,-100,"Items",{fontSize:"22px",color:"#4ade80",fontStyle:"bold"}).setOrigin(.5);this.itemPanelContainer.add(a);let r=this.add.text(170,-100,"X",{fontSize:"18px",color:"#ef4444",backgroundColor:"#2a2a2a",padding:{x:8,y:4}}).setOrigin(.5).setInteractive();r.on("pointerdown",()=>this.hideItemPanel()),this.itemPanelContainer.add(r),t.forEach((t,e)=>{var s;let i=-60+35*e;if(i>80)return;let a=this.add.text(0,i,"".concat(t.name," - ").concat(null!=(s=t.description)?s:"Consumable"),{fontSize:"14px",color:"#ffffff",backgroundColor:"#2a4a3a",padding:{x:10,y:5},wordWrap:{width:360}}).setOrigin(.5).setInteractive();a.on("pointerdown",()=>{this.hideItemPanel(),this.useSelectedItem(t)}),a.on("pointerover",()=>a.setBackgroundColor("#3a6a4a")),a.on("pointerout",()=>a.setBackgroundColor("#2a4a3a")),this.itemPanelContainer.add(a)})}hideItemPanel(){this.itemPanelContainer&&(this.itemPanelContainer.removeAll(!0),this.itemPanelContainer.destroy(),this.itemPanelContainer=null)}useSelectedItem(t){var e,s;if(!this.player||!this.techDebt||!this.itemSystem)return;this.isPlayerTurn=!1,this.setActionsEnabled(!1);let i=this.itemSystem.useItem(t);if(i.success){let s="Used ".concat(t.name,"!");i.hpRestored&&i.hpRestored>0&&(s+=" +".concat(i.hpRestored," HP")),i.mpRestored&&i.mpRestored>0&&(s+=" +".concat(i.mpRestored," MP")),null==(e=this.turnText)||e.setText(s),this.updateUI(),this.time.delayedCall(1e3,()=>this.monsterTurn())}else null==(s=this.turnText)||s.setText(i.message),this.isPlayerTurn=!0,this.setActionsEnabled(!0)}autoRestoreMP(){if(!this.player)return 0;let t=Math.floor(.05*this.player.stats.MP);return this.player.currentMP=Math.min(this.player.stats.MP,this.player.currentMP+t),t}handleVictory(){var t,e,s,i,a;if(!this.player||!this.monster||!this.levelUpSystem||!this.techDebt)return;this.player.currentMP=this.player.stats.MP;let r=null!=(i=null==(t=this.sceneData)?void 0:t.chapter)?i:1,n=null!=(a=null==(e=this.sceneData)?void 0:e.stage)?a:1;this.stagesCompleted.push(100*r+n);let l=this.monster.drops.exp,o=this.monster.drops.gold;this.player.gold+=o;let c="";if(this.itemSystem){let t=this.itemSystem.rollLoot(this.monster.drops);if(t.items.length>0){let e=this.itemSystem.collectDrops(t).collected.map(t=>t.name).join(", ");e&&(c="\nItems: ".concat(e))}}null==(s=this.turnText)||s.setText("Victory! Defeated ".concat(this.monster.name,"!\n+").concat(l," EXP, +").concat(o," Gold, MP restored").concat(c)),this.updateUI(),this.time.delayedCall(1500,()=>{if(!this.levelUpSystem||!this.techDebt||!this.progressionSystem)return;let t=this.levelUpSystem.addExp(l);if(t){var e;let s=Object.entries(t.statsGained).filter(t=>{let[e,s]=t;return s&&s>0}).map(t=>{let[e,s]=t;return"".concat(e,"+").concat(s)}).join(", ");null==(e=this.turnText)||e.setText("LEVEL UP! Lv.".concat(t.newLevel,"\n")+"Stats increased: ".concat(s,"\n")+"HP and MP fully restored!"),this.updateUI(),this.time.delayedCall(2500,()=>this.completeStageAndAdvance())}else this.time.delayedCall(1e3,()=>this.completeStageAndAdvance())})}completeStageAndAdvance(){var t,e;if(!this.progressionSystem||!this.techDebt||!this.sceneData)return;let s=Math.floor((Date.now()-this.battleStartTime)/1e3),i=(null!=(t=this.sceneData.playTime)?t:0)+s,a=this.progressionSystem.completeStage(this.techDebt.current,s),r=this.sceneData.chapter,n=this.sceneData.stage;if(2===r&&5===n||a.chapterCompleted&&2===r)return void this.transitionToEnding(i);if(a.chapterCompleted&&a.newChapterUnlocked){null==(e=this.turnText)||e.setText("Chapter ".concat(r," Complete! Chapter ").concat(r+1," Unlocked!")),this.updateUI(),this.time.delayedCall(2500,()=>{this.advanceToNextStage(!0)});return}this.advanceToNextStage(!0)}advanceToNextStage(t){var e,s;if(!this.progressionSystem||!this.sceneData||!this.techDebt||!this.eventSystem)return;let i=this.progressionSystem.getCurrentChapter(),a=this.progressionSystem.getCurrentStage(),r=Math.floor((Date.now()-this.battleStartTime)/1e3),n=(null!=(e=this.sceneData.playTime)?e:0)+r,l={playerClass:this.sceneData.playerClass,chapter:i,stage:a,player:null!=(s=this.player)?s:void 0,techDebtCarry:this.techDebt.current,progression:this.progressionSystem,stagesCompleted:this.stagesCompleted,playTime:n};if(t){let t=this.eventSystem.rollEvent();if(t.event){this.eventSystem.setLastEventResult(t);let e={event:t.event,returnScene:"BattleScene",returnData:l};this.scene.start("EventScene",e);return}}this.scene.start("BattleScene",l)}transitionToEnding(t){var e;if(!this.techDebt||!this.progressionSystem||!this.player)return;let s=this.stagesCompleted.length>=11,i={endingType:D.determineEnding(this.techDebt.current,s,!0),techDebt:this.techDebt.current,totalDefeated:this.progressionSystem.getTotalDefeated(),playTime:t,chapter:2,finalLevel:this.player.level};null==(e=this.turnText)||e.setText("The final bug has been vanquished..."),this.updateUI(),this.time.delayedCall(3e3,()=>{this.scene.start("EndingScene",i)})}handleDefeat(){var t;null==(t=this.turnText)||t.setText("Defeat... The bug won.\nReturning to try again..."),this.time.delayedCall(2e3,()=>{if(this.sceneData){var t,e,s;this.scene.start("BattleScene",{playerClass:this.sceneData.playerClass,chapter:this.sceneData.chapter,stage:this.sceneData.stage,techDebtCarry:null!=(e=null==(t=this.techDebt)?void 0:t.current)?e:0,progression:this.progressionSystem,stagesCompleted:this.stagesCompleted,playTime:null!=(s=this.sceneData.playTime)?s:0})}else this.scene.start("ClassSelectScene")})}applyBossPhaseVisuals(t){var e,s,i;if(!this.bossSprite||!this.monster)return;let a=this.BOSS_PHASE_CONFIG[t];if(!a)return;this.cameras.main.shake(300,a.shakeIntensity/1e3),this.cameras.main.flash(400,a.tint>>16&255,a.tint>>8&255,255&a.tint,!1),this.tweens.add({targets:this.bossSprite,fillColor:a.tint,duration:800,ease:"Power2"}),this.tweens.add({targets:this.bossSprite,scaleX:1.3,scaleY:1.3,duration:400,yoyo:!0,ease:"Back.easeOut"}),this.bossPhaseOverlay&&this.tweens.add({targets:this.bossPhaseOverlay,fillColor:a.tint,alpha:a.overlayAlpha,duration:600});let r=a.dialogues[Math.floor(Math.random()*a.dialogues.length)];this.bossDialogueText&&r&&(this.bossDialogueText.setText(r),this.bossDialogueText.setVisible(!0),this.bossDialogueText.setAlpha(0),this.tweens.add({targets:this.bossDialogueText,alpha:1,duration:300}),this.time.delayedCall(2e3,()=>{this.bossDialogueText&&this.tweens.add({targets:this.bossDialogueText,alpha:0,duration:300,onComplete:()=>{var t;null==(t=this.bossDialogueText)||t.setVisible(!1)}})}));let n=null!=(i=null==(e=this.enemyAI)?void 0:e.getPhaseDescription())?i:"";null==(s=this.turnText)||s.setText("WARNING: ".concat(this.monster.name," enters ").concat(n,"!")),this.updateUI()}updateUI(){var t,e,s,i,a,r,n,l,o,c,h,d,u;if(!this.player||!this.monster||!this.techDebt)return;let p=null==(t=this.levelUpSystem)?void 0:t.getLevelInfo(),f=p?"\nLv.".concat(p.level," | EXP: ").concat(p.exp,"/").concat(p.expForNextLevel):"",g=this.focusBuff?"\n[FOCUS: +20% DMG next attack]":"";null==(e=this.playerHPText)||e.setText("".concat(this.player.name).concat(f)+"\nHP: ".concat(this.player.currentHP,"/").concat(this.player.stats.HP)+"\nMP: ".concat(this.player.currentMP,"/").concat(this.player.stats.MP)+"\nGold: ".concat(this.player.gold)+g);let m="boss"===this.monster.type,y=null!=(d=null==(s=this.enemyAI)?void 0:s.phase)?d:1,b=m&&this.enemyAI?"\nPhase ".concat(y,"/4"):"",x="#ef4444";if(m){let t=this.BOSS_PHASE_CONFIG[y];t&&(x="#"+t.tint.toString(16).padStart(6,"0"))}if(null==(i=this.monsterHPText)||i.setText("".concat(this.monster.name,"\nHP: ").concat(this.monster.currentHP,"/").concat(this.monster.stats.HP).concat(b)),null==(a=this.monsterHPText)||a.setColor(x),this.buffText){let t=[];for(let e of this.activeBuffs)if("DOT"===e.stat)t.push("[DoT on ".concat(e.target,"] ").concat(e.value," dmg (").concat(e.turnsRemaining,"t)"));else{let s=e.value>=0?"+":"";t.push("[".concat(e.target,"] ").concat(s).concat(e.value," ").concat(e.stat," (").concat(e.turnsRemaining,"t)"))}this.buffText.setText(t.join("\n"))}if(this.statusEffectText){let t=[];for(let e of this.statusEffects){let s="stun"===e.type?"⚡":"❓",i=e.type.toUpperCase();t.push("".concat(s," [").concat(e.target,"] ").concat(i," (").concat(e.turnsRemaining,"t)"))}this.statusEffectText.setText(t.join("  "))}let S=this.techDebt.getStatus(),v=this.cameras.main.width/2-150,P=this.cameras.main.height-250,w=S.current/100*300;null==(r=this.techDebtBar)||r.clear(),null==(n=this.techDebtBar)||n.fillStyle(parseInt(S.color.replace("#","0x"),16),1),null==(l=this.techDebtBar)||l.fillRect(v,P,w,20),null==(o=this.techDebtText)||o.setText("".concat(S.current,"/100 - ").concat(S.description)),null==(c=this.techDebtText)||c.setColor(S.color),(null==(h=this.turnText)?void 0:h.text)||null==(u=this.turnText)||u.setText("Your turn! Choose an action.")}update(t,e){if(!this.bossSprite||!this.monster||"boss"!==this.monster.type||!this.enemyAI)return;let s=this.enemyAI.phase;if(s>=3){let e=.3+.2*Math.sin(t*(4===s?.008:.004));if(this.bossSprite.setAlpha(e),4===s){let t=(Math.random()-.5)*2,e=(Math.random()-.5)*2,s=this.cameras.main.width-150;this.bossSprite.setPosition(s+t,300+e)}}else this.bossSprite.setAlpha(1)}constructor(){super({key:"BattleScene"}),this.player=null,this.monster=null,this.techDebt=null,this.enemyAI=null,this.levelUpSystem=null,this.progressionSystem=null,this.itemSystem=null,this.eventSystem=null,this.sceneData=null,this.focusBuff=!1,this.activeBuffs=[],this.isPlayerTurn=!0,this.battleStartTime=0,this.stagesCompleted=[],this.skillCooldowns=new Map,this.attackCount=0,this.statusEffects=[],this.turnText=null,this.playerHPText=null,this.monsterHPText=null,this.techDebtText=null,this.techDebtBar=null,this.buffText=null,this.statusEffectText=null,this.stageText=null,this.bossPhaseOverlay=null,this.bossDialogueText=null,this.bossSprite=null,this.lastBossPhase=1,this.skillPanelContainer=null,this.skillPanelVisible=!1,this.itemPanelContainer=null,this.actionButtons=[],this.BOSS_PHASE_CONFIG={1:{tint:0xffffff,overlayAlpha:0,dialogues:["Let's see what you've got...","Is that all?"],shakeIntensity:0},2:{tint:0xdcdcaa,overlayAlpha:.1,dialogues:["You're not bad...","I'm just getting started!","My code is evolving!"],shakeIntensity:2},3:{tint:0xce9178,overlayAlpha:.15,dialogues:["COMPILING RAGE!","Stack overflow incoming!","You can't refactor ME!"],shakeIntensity:4},4:{tint:0xf44747,overlayAlpha:.25,dialogues:["SEGFAULT... SEGFAULT...","I... won't... crash...","FATAL ERROR!"],shakeIntensity:8}},this.minigameActive=!1,this.eventSystem=new M}}let A=JSON.parse('{"e":[{"id":"conflict-01","title":"Null Safety","head":"if (user !== null) {\\n  return user.name;\\n}","incoming":"if (user) {\\n  return user.Name;\\n}","options":["if (user !== null) {\\n  return user.name;\\n}","if (user) {\\n  return user.Name;\\n}","if (user != null) {\\n  return user.Name;\\n}"],"correctIndex":0,"hint":"Use strict equality and correct property casing"},{"id":"conflict-02","title":"Loop Bounds","head":"for (let i = 0; i < arr.length; i++)","incoming":"for (let i = 0; i <= arr.length; i++)","options":["for (let i = 0; i < arr.length; i++)","for (let i = 0; i <= arr.length; i++)","for (let i = 1; i < arr.length; i++)","for (let i = 0; i < arr.length - 1; i++)"],"correctIndex":0,"hint":"Off-by-one: use < not <= with .length"},{"id":"conflict-03","title":"SQL Query","head":"db.query(\'SELECT * FROM users WHERE id = ?\', [id]);","incoming":"db.query(`SELECT * FROM users WHERE id = ${id}`);","options":["db.query(\'SELECT * FROM users WHERE id = ?\', [id]);","db.query(`SELECT * FROM users WHERE id = ${id}`);","db.query(\'SELECT * FROM users WHERE id = \' + id);"],"correctIndex":0,"hint":"Use parameterized queries to prevent SQL injection"},{"id":"conflict-04","title":"XSS Prevention","head":"el.textContent = userInput;","incoming":"el.innerHTML = userInput;","options":["el.textContent = userInput;","el.innerHTML = userInput;","el.innerHTML = escapeHtml(userInput);","el.outerHTML = userInput;"],"correctIndex":0,"hint":"Use textContent to safely render user input"},{"id":"conflict-05","title":"Error Handling","head":"try {\\n  return await api.get(\'/data\');\\n} catch (err) {\\n  log(err);\\n}","incoming":"return await api.get(\'/data\');","options":["try {\\n  return await api.get(\'/data\');\\n} catch (err) {\\n  log(err);\\n}","return await api.get(\'/data\');","return api.get(\'/data\').catch(() => {});"],"correctIndex":0,"hint":"Always handle errors in async functions"},{"id":"conflict-06","title":"Memory Leak","head":"btn.addEventListener(\'click\', handler);\\n// cleanup:\\nbtn.removeEventListener(\'click\', handler);","incoming":"btn.addEventListener(\'click\', handler);","options":["btn.addEventListener(\'click\', handler);\\nbtn.removeEventListener(\'click\', handler);","btn.addEventListener(\'click\', handler);","btn.onclick = handler;","btn.addEventListener(\'click\', () => handler());"],"correctIndex":0,"hint":"Remove event listeners to prevent memory leaks"},{"id":"conflict-07","title":"Variable Scope","head":"let counter = 0;","incoming":"var counter = 0;","options":["let counter = 0;","var counter = 0;","counter = 0;"],"correctIndex":0,"hint":"Use let/const instead of var for block scoping"},{"id":"conflict-08","title":"Async Parallel","head":"await Promise.all([fetch(a), fetch(b)]);","incoming":"await fetch(a);\\nawait fetch(b);","options":["await Promise.all([fetch(a), fetch(b)]);","await fetch(a);\\nawait fetch(b);","Promise.all([fetch(a), fetch(b)]);","fetch(a); fetch(b);"],"correctIndex":0,"hint":"Use Promise.all for parallel async operations"},{"id":"conflict-09","title":"Type Check","head":"if (typeof val === \'undefined\') {","incoming":"if (val == undefined) {","options":["if (typeof val === \'undefined\') {","if (val == undefined) {","if (val === undefined) {","if (!val) {"],"correctIndex":0,"hint":"typeof check is safest for undefined values"},{"id":"conflict-10","title":"Array Transform","head":"const doubled = nums.map(n => n * 2);","incoming":"const doubled = [];\\nfor (let i = 0; i < nums.length; i++)\\n  doubled[i] = nums[i] * 2;","options":["const doubled = nums.map(n => n * 2);","const doubled = [];\\nfor (let i ...) doubled[i] = nums[i] * 2;","const doubled = nums.forEach(n => n * 2);"],"correctIndex":0,"hint":"Use .map() for clean array transformations"},{"id":"conflict-11","title":"Race Condition","head":"await mutex.acquire();\\ntry { shared++; }\\nfinally { mutex.release(); }","incoming":"shared++;","options":["await mutex.acquire();\\ntry { shared++; }\\nfinally { mutex.release(); }","shared++;","await lock();\\nshared++;","synchronized { shared++; }"],"correctIndex":0,"hint":"Use mutex locks for shared state access"},{"id":"conflict-12","title":"Object Clone","head":"const copy = { ...obj };","incoming":"const copy = obj;","options":["const copy = { ...obj };","const copy = obj;","const copy = Object.assign(obj);","const copy = obj.clone();"],"correctIndex":0,"hint":"Spread operator creates a shallow clone"},{"id":"conflict-13","title":"Switch Default","head":"switch (s) {\\n  case \'a\': return 1;\\n  default: throw Error(\'unknown\');\\n}","incoming":"switch (s) {\\n  case \'a\': return 1;\\n}","options":["switch (s) {\\n  case \'a\': return 1;\\n  default: throw Error(\'unknown\');\\n}","switch (s) {\\n  case \'a\': return 1;\\n}","switch (s) {\\n  case \'a\': return 1;\\n  default: break;\\n}"],"correctIndex":0,"hint":"Always add a default case to catch unknowns"},{"id":"conflict-14","title":"parseInt Radix","head":"const val = parseInt(input, 10);","incoming":"const val = parseInt(input);","options":["const val = parseInt(input, 10);","const val = parseInt(input);","const val = Number(input);","const val = +input;"],"correctIndex":0,"hint":"Always specify radix in parseInt"},{"id":"conflict-15","title":"Timer Cleanup","head":"componentWillUnmount() {\\n  clearInterval(this.timer);\\n}","incoming":"// no cleanup","options":["componentWillUnmount() {\\n  clearInterval(this.timer);\\n}","// no cleanup needed","componentWillUnmount() {\\n  this.timer = null;\\n}"],"correctIndex":0,"hint":"Clean up timers in lifecycle methods"},{"id":"conflict-16","title":"JSON Parse","head":"try {\\n  data = JSON.parse(input);\\n} catch { handleError(); }","incoming":"data = JSON.parse(input);","options":["try {\\n  data = JSON.parse(input);\\n} catch { handleError(); }","data = JSON.parse(input);","data = JSON.parse(input) || {};","data = eval(input);"],"correctIndex":0,"hint":"Always wrap JSON.parse in try-catch"},{"id":"conflict-17","title":"Array Search","head":"const r = items.find(i => i.id === target);","incoming":"let r = null;\\nfor (let i = 0; i < items.length; i++)\\n  if (items[i].id === target) r = items[i];","options":["const r = items.find(i => i.id === target);","let r; for (...) if (items[i].id === target) r = items[i];","const r = items.filter(i => i.id === target);","const r = items.indexOf(target);"],"correctIndex":0,"hint":"Use .find() for single-element search"},{"id":"conflict-18","title":"Config Immutability","head":"const cfg = Object.freeze({ URL: \'...\' });","incoming":"const cfg = { URL: \'...\' };","options":["const cfg = Object.freeze({ URL: \'...\' });","const cfg = { URL: \'...\' };","let cfg = { URL: \'...\' };","var cfg = Object.freeze({ URL: \'...\' });"],"correctIndex":0,"hint":"Freeze config objects to prevent mutation"},{"id":"conflict-19","title":"Equality Check","head":"if (a === b && typeof a === \'number\')","incoming":"if (a == b)","options":["if (a === b && typeof a === \'number\')","if (a == b)","if (a === b)","if (a >= b && a <= b)"],"correctIndex":0,"hint":"Strict equality with type guard is safest"},{"id":"conflict-20","title":"Promise Chain","head":"fetch(url)\\n  .then(r => r.json())\\n  .catch(err => log(err));","incoming":"fetch(url)\\n  .then(r => r.json());","options":["fetch(url)\\n  .then(r => r.json())\\n  .catch(err => log(err));","fetch(url)\\n  .then(r => r.json());","fetch(url).then(r => r.text());","fetch(url).catch(err => log(err));"],"correctIndex":0,"hint":"Always add .catch() to promise chains"}]}'),O={bg:1973790,bgElevated:2960688,bgSecondary:2434342,border:4079170,text:"#d4d4d4",textMuted:"#858585",blue:"#569cd6",blueHex:5676246,green:"#4ec9b0",greenHex:5163440,yellow:"#dcdcaa",yellowHex:0xdcdcaa,red:"#f48771",redHex:0xf48771,pink:"#c586c0",orange:"#ce9178",orangeHex:0xce9178,white:"#ffffff",selection:2510712};class B extends n().Scene{init(t){this.sceneData=t,this.conflicts=A.e,this.currentRound=0,this.score=0,this.roundActive=!1,this.gameOver=!1,this.roundUI=[];let e=n().Utils.Array.Shuffle([...this.conflicts]);this.roundConflicts=e.slice(0,5)}create(){let t=this.cameras.main.width,e=this.cameras.main.height;this.add.rectangle(t/2,e/2,t,e,O.bg),this.add.rectangle(t/2,25,t,50,O.bgSecondary),this.titleText=this.add.text(t/2,25,"MERGE CONFLICT",{fontSize:"28px",color:O.red,fontStyle:"bold",fontFamily:"monospace"}).setOrigin(.5),this.roundLabel=this.add.text(16,60,"",{fontSize:"16px",color:O.blue,fontFamily:"monospace"}),this.scoreLabel=this.add.text(t-16,60,"",{fontSize:"16px",color:O.green,fontFamily:"monospace"}).setOrigin(1,0),this.timerBarWidth=t-40,this.timerBarX=20,this.timerBarY=85,this.add.rectangle(this.timerBarX+this.timerBarWidth/2,this.timerBarY+6,this.timerBarWidth,12,3355443),this.timerBar=this.add.graphics(),this.timerText=this.add.text(t/2,this.timerBarY+6,"",{fontSize:"12px",color:O.white,fontFamily:"monospace"}).setOrigin(.5),this.startRound()}update(){if(this.roundActive&&!this.gameOver&&this.timerEvent&&this.timerBar){let t=this.timerEvent.getProgress(),e=15*(1-t);this.timerBar.clear();let s=O.greenHex;e<5?s=O.redHex:e<10&&(s=O.yellowHex);let i=this.timerBarWidth*(1-t);this.timerBar.fillStyle(s),this.timerBar.fillRect(this.timerBarX,this.timerBarY,i,12),this.timerText&&this.timerText.setText("".concat(e.toFixed(1),"s"))}}startRound(){var t,e;if(this.clearRoundUI(),this.currentRound>=5)return void this.showResults();let s=this.roundConflicts[this.currentRound];this.roundActive=!0,null==(t=this.roundLabel)||t.setText("Round ".concat(this.currentRound+1," / ").concat(5)),null==(e=this.scoreLabel)||e.setText("Score: ".concat(this.score," / ").concat(this.currentRound));let i=this.cameras.main.width,a=this.add.text(i/2,110,"// ".concat(s.title),{fontSize:"18px",color:O.pink,fontFamily:"monospace"}).setOrigin(.5);this.roundUI.push(a),this.createConflictDisplay(s),this.createOptionButtons(s);let r=this.add.text(i/2,this.cameras.main.height-20,"Hint: ".concat(s.hint),{fontSize:"13px",color:O.textMuted,fontFamily:"monospace",wordWrap:{width:i-40},align:"center"}).setOrigin(.5);this.roundUI.push(r),this.timerEvent=this.time.addEvent({delay:15e3,callback:()=>this.handleTimeout()})}createConflictDisplay(t){let e=this.cameras.main.width,s=e-60,i=this.add.rectangle(e/2,205,s,140,O.bgElevated).setStrokeStyle(1,O.border);this.roundUI.push(i);let a=this.add.text(40,145,"<<<<<<< HEAD",{fontSize:"13px",color:O.green,fontFamily:"monospace",fontStyle:"bold"});this.roundUI.push(a);let r=this.add.text(50,165,t.head,{fontSize:"13px",color:"#89d185",fontFamily:"monospace",wordWrap:{width:s-40}});this.roundUI.push(r);let n=this.add.text(40,205,"=======",{fontSize:"13px",color:O.textMuted,fontFamily:"monospace",fontStyle:"bold"});this.roundUI.push(n);let l=this.add.text(50,225,t.incoming,{fontSize:"13px",color:O.red,fontFamily:"monospace",wordWrap:{width:s-40}});this.roundUI.push(l);let o=this.add.text(40,255,">>>>>>> incoming",{fontSize:"13px",color:O.red,fontFamily:"monospace",fontStyle:"bold"});this.roundUI.push(o);let c=this.add.text(e/2,290,"Choose the correct resolution:",{fontSize:"15px",color:O.yellow,fontFamily:"monospace"}).setOrigin(.5);this.roundUI.push(c)}createOptionButtons(t){let e=this.cameras.main.width,s=t.options,i=s.length,a=e-60,r=[];for(let t=0;t<i;t++)r.push(t);n().Utils.Array.Shuffle(r);for(let i=0;i<r.length;i++){var l;let n=r[i],o=310+60*i,c=n===t.correctIndex,h=this.add.rectangle(e/2,o+26,a,52,O.bgSecondary).setStrokeStyle(2,O.border).setInteractive({useHandCursor:!0});this.roundUI.push(h);let d=String.fromCharCode(65+i),u=this.add.text(40,o+26,"".concat(d,")"),{fontSize:"16px",color:O.blue,fontFamily:"monospace",fontStyle:"bold"}).setOrigin(0,.5);this.roundUI.push(u);let p=s[n].replace(/\n/g,"  "),f=this.add.text(70,o+26,p,{fontSize:"13px",color:O.text,fontFamily:"monospace",wordWrap:{width:a-80}}).setOrigin(0,.5);this.roundUI.push(f),h.on("pointerover",()=>{this.roundActive&&(h.setStrokeStyle(2,O.blueHex),h.setFillStyle(O.selection))}),h.on("pointerout",()=>{this.roundActive&&(h.setStrokeStyle(2,O.border),h.setFillStyle(O.bgSecondary))}),h.on("pointerdown",()=>{this.roundActive&&this.handleAnswer(c,h)});let g=null==(l=this.input.keyboard)?void 0:l.addKey(d);if(g){let t=()=>{this.roundActive&&this.handleAnswer(c,h)};g.on("down",t),this.roundUI.push({destroy:()=>g.off("down",t)})}}}handleAnswer(t,e){var s,i;this.roundActive=!1,null==(s=this.timerEvent)||s.remove(!1);let a=this.cameras.main.width,r=this.cameras.main.height;if(t){this.score++,e.setStrokeStyle(3,O.greenHex),e.setFillStyle(O.greenHex,.2);let t=this.add.text(a/2,r/2,"RESOLVED!",{fontSize:"48px",color:O.green,fontStyle:"bold",fontFamily:"monospace"}).setOrigin(.5).setAlpha(0).setDepth(10);this.roundUI.push(t),this.tweens.add({targets:t,alpha:1,scale:{from:.5,to:1},duration:300,ease:"Back.easeOut"});let s=this.add.rectangle(a/2,r/2,a,r,O.greenHex,.15).setDepth(9);this.roundUI.push(s),this.tweens.add({targets:s,alpha:0,duration:500})}else{e.setStrokeStyle(3,O.redHex),e.setFillStyle(O.redHex,.2);let t=this.add.text(a/2,r/2,"CONFLICT!",{fontSize:"48px",color:O.red,fontStyle:"bold",fontFamily:"monospace"}).setOrigin(.5).setAlpha(0).setDepth(10);this.roundUI.push(t),this.tweens.add({targets:t,alpha:1,scale:{from:.5,to:1},duration:300,ease:"Back.easeOut"});let s=this.add.rectangle(a/2,r/2,a,r,O.redHex,.15).setDepth(9);this.roundUI.push(s),this.tweens.add({targets:s,alpha:0,duration:500}),this.cameras.main.shake(200,.005)}null==(i=this.scoreLabel)||i.setText("Score: ".concat(this.score," / ").concat(this.currentRound+1)),this.currentRound++,this.time.delayedCall(1200,()=>this.startRound())}handleTimeout(){var t;if(!this.roundActive)return;this.roundActive=!1;let e=this.cameras.main.width,s=this.cameras.main.height,i=this.add.text(e/2,s/2,"TIME OUT!",{fontSize:"48px",color:O.orange,fontStyle:"bold",fontFamily:"monospace"}).setOrigin(.5).setAlpha(0).setDepth(10);this.roundUI.push(i),this.tweens.add({targets:i,alpha:1,scale:{from:.5,to:1},duration:300,ease:"Back.easeOut"});let a=this.add.rectangle(e/2,s/2,e,s,O.orangeHex,.15).setDepth(9);this.roundUI.push(a),this.tweens.add({targets:a,alpha:0,duration:500}),this.cameras.main.shake(200,.005),null==(t=this.scoreLabel)||t.setText("Score: ".concat(this.score," / ").concat(this.currentRound+1)),this.currentRound++,this.time.delayedCall(1200,()=>this.startRound())}showResults(){var t,e,s,i,a,r,n;let l;this.clearRoundUI(),this.gameOver=!0,null==(t=this.timerBar)||t.clear(),null==(e=this.timerText)||e.setText(""),null==(s=this.roundLabel)||s.setText("");let o=this.cameras.main.width,c=this.cameras.main.height,h=this.score>=3;null==(i=this.titleText)||i.setText(h?"MERGE COMPLETE!":"BUILD FAILED!"),null==(a=this.titleText)||a.setColor(h?O.green:O.red),this.add.text(o/2,120,"".concat(this.score," / ").concat(5," Conflicts Resolved"),{fontSize:"24px",color:O.text,fontFamily:"monospace"}).setOrigin(.5),l=this.score>=5?"★★★":this.score>=4?"★★☆":this.score>=3?"★☆☆":"☆☆☆",this.add.text(o/2,155,l,{fontSize:"36px",color:this.score>=3?O.yellow:O.textMuted,fontFamily:"monospace"}).setOrigin(.5),this.add.rectangle(o/2,290,o-80,180,O.bgElevated).setStrokeStyle(2,h?O.greenHex:O.redHex);let d=220;for(let t=0;t<5;t++){let e=t<this.score,s=e?"✓":"✗",i=e?O.green:O.red,a=this.roundConflicts[t];this.add.text(60,d,"".concat(s,"  Round ").concat(t+1,": ").concat(a.title),{fontSize:"14px",color:i,fontFamily:"monospace"}),d+=28}if(h){let t=15*this.score;this.add.text(o/2,410,"+ ".concat(t," Gold"),{fontSize:"22px",color:O.yellow,fontStyle:"bold",fontFamily:"monospace"}).setOrigin(.5),5===this.score&&this.add.text(o/2,440,"PERFECT! Bonus: Debug Potion",{fontSize:"16px",color:O.green,fontFamily:"monospace"}).setOrigin(.5),this.data.set("success",!0),this.data.set("goldReward",t),this.data.set("perfectClear",5===this.score)}else this.add.text(o/2,410,"Tech Debt + ".concat(10),{fontSize:"22px",color:O.red,fontStyle:"bold",fontFamily:"monospace"}).setOrigin(.5),this.add.text(o/2,440,"Unresolved conflicts increase tech debt!",{fontSize:"14px",color:O.textMuted,fontFamily:"monospace"}).setOrigin(.5),this.data.set("success",!1),this.data.set("techDebtPenalty",10);this.data.set("score",this.score);let u=c-60,p=this.add.rectangle(o/2,u,220,50,O.blueHex,.8).setStrokeStyle(2,O.blueHex).setInteractive({useHandCursor:!0});this.add.text(o/2,u,"Continue",{fontSize:"20px",color:O.white,fontFamily:"monospace"}).setOrigin(.5),p.on("pointerover",()=>p.setFillStyle(O.blueHex,1)),p.on("pointerout",()=>p.setFillStyle(O.blueHex,.8)),p.on("pointerdown",()=>this.exitMinigame()),null==(r=this.input.keyboard)||r.once("keydown-ENTER",()=>this.exitMinigame()),null==(n=this.input.keyboard)||n.once("keydown-SPACE",()=>this.exitMinigame())}exitMinigame(){var t,e;let s=(null==(t=this.sceneData)?void 0:t.returnScene)||"DungeonSelectScene",i=(null==(e=this.sceneData)?void 0:e.returnData)||{};this.scene.start(s,{...i,minigameResult:{success:this.data.get("success"),score:this.score,goldReward:this.data.get("goldReward")||0,techDebtPenalty:this.data.get("techDebtPenalty")||0,perfectClear:this.data.get("perfectClear")||!1}})}clearRoundUI(){this.roundUI.forEach(t=>{t&&"function"==typeof t.destroy&&t.destroy()}),this.roundUI=[]}constructor(){super({key:"MinigameScene"}),this.conflicts=[],this.roundConflicts=[],this.currentRound=0,this.score=0,this.roundActive=!1,this.gameOver=!1,this.timerBarX=0,this.timerBarWidth=0,this.timerBarY=0,this.roundUI=[]}}class H extends n().Scene{init(t){this.eventData=t,this.canSkip=!1,this.choiceMade=!1}create(){if(!this.eventData){console.error("EventScene: No event data provided"),this.scene.start("BattleScene");return}let{event:t}=this.eventData,e=this.cameras.main.width/2,s=this.cameras.main.height/2;this.add.rectangle(0,0,this.cameras.main.width,this.cameras.main.height,this.COLOR_BG,.95).setOrigin(0,0);let i=this.add.text(e,s-160,t.icon,{fontSize:"96px",fontFamily:"Arial"});i.setOrigin(.5),i.setAlpha(0);let a=this.add.text(e,s-60,t.name,{fontSize:"32px",fontFamily:"Arial",color:"#".concat(this.COLOR_YELLOW.toString(16).padStart(6,"0")),fontStyle:"bold",align:"center",wordWrap:{width:700}});a.setOrigin(.5),a.setAlpha(0);let r=this.add.text(e,s+10,t.description,{fontSize:"20px",fontFamily:"Arial",color:"#".concat(this.COLOR_WHITE.toString(16).padStart(6,"0")),align:"center",wordWrap:{width:600}});r.setOrigin(.5),r.setAlpha(0),this.tweens.add({targets:i,alpha:1,scale:{from:.5,to:1},duration:300,ease:"Back.easeOut"}),this.tweens.add({targets:a,alpha:1,y:s-50,duration:400,delay:200,ease:"Power2"}),this.tweens.add({targets:r,alpha:1,duration:400,delay:500,ease:"Power2"}),t.choices&&t.choices.length>0?this.showChoices(t,e,s):this.showAutoResolve(t,e,s)}showChoices(t,e,s){let i=t.choices,a=s+70;this.time.delayedCall(800,()=>{i.forEach((r,n)=>{var l,o;let c=a+62*n,h=this.add.rectangle(e,c,500,50,this.COLOR_PANEL);h.setStrokeStyle(1,this.COLOR_BORDER),h.setInteractive({useHandCursor:!0}),h.setAlpha(0);let d=String.fromCharCode(65+n),u=this.add.text(e,c,"[".concat(d,"] ").concat(r.text),{fontSize:"18px",fontFamily:"'Consolas', 'Courier New', monospace",color:"#".concat(this.COLOR_WHITE.toString(16).padStart(6,"0")),align:"center",wordWrap:{width:460}});u.setOrigin(.5),u.setAlpha(0),this.tweens.add({targets:[h,u],alpha:1,duration:300,delay:100*n}),h.on("pointerover",()=>{this.choiceMade||(h.setFillStyle(this.COLOR_HOVER),h.setStrokeStyle(2,this.COLOR_BLUE),u.setColor("#".concat(this.COLOR_BLUE.toString(16).padStart(6,"0"))))}),h.on("pointerout",()=>{this.choiceMade||(h.setFillStyle(this.COLOR_PANEL),h.setStrokeStyle(1,this.COLOR_BORDER),u.setColor("#".concat(this.COLOR_WHITE.toString(16).padStart(6,"0"))))}),h.on("pointerdown",()=>{this.choiceMade||(this.choiceMade=!0,this.handleChoice(r,t,e,s,i,n))}),null==(l=this.input.keyboard)||l.on("keydown-".concat(n+1),()=>{this.choiceMade||(this.choiceMade=!0,this.handleChoice(r,t,e,s,i,n))}),null==(o=this.input.keyboard)||o.on("keydown-".concat(d),()=>{this.choiceMade||(this.choiceMade=!0,this.handleChoice(r,t,e,s,i,n))})})})}handleChoice(t,e,s,i,a,r){var l,o;this.applyChoiceEffects(t.effects);let c=this.getChoiceEffectColor(t);this.applyEffectAnimation(c,this.isPositiveChoice(t)),this.children.each(t=>{t instanceof n().GameObjects.Rectangle&&t!==this.children.first&&this.tweens.add({targets:t,alpha:0,duration:200})});let h=i+90,d=this.add.text(s,h,t.resultText,{fontSize:"24px",fontFamily:"Arial",color:"#".concat(c.toString(16).padStart(6,"0")),fontStyle:"bold",align:"center",wordWrap:{width:600}});d.setOrigin(.5),d.setAlpha(0),this.tweens.add({targets:d,alpha:1,scale:{from:1.2,to:1},duration:500,delay:300,ease:"Back.easeOut"});let u=this.add.text(s,h+60,"Click to Continue",{fontSize:"18px",fontFamily:"Arial",color:"#".concat(this.COLOR_BLUE.toString(16).padStart(6,"0")),fontStyle:"italic"});u.setOrigin(.5),u.setAlpha(0),this.tweens.add({targets:u,alpha:1,duration:300,delay:800,onComplete:()=>{this.canSkip=!0}}),this.tweens.add({targets:u,alpha:.5,duration:800,delay:1100,yoyo:!0,repeat:-1}),this.autoAdvanceTimer=this.time.delayedCall(4e3,()=>{this.transitionToNextScene()}),this.input.on("pointerdown",()=>{this.canSkip&&(this.autoAdvanceTimer&&this.autoAdvanceTimer.remove(),this.transitionToNextScene())}),null==(l=this.input.keyboard)||l.on("keydown-SPACE",()=>{this.canSkip&&(this.autoAdvanceTimer&&this.autoAdvanceTimer.remove(),this.transitionToNextScene())}),null==(o=this.input.keyboard)||o.on("keydown-ENTER",()=>{this.canSkip&&(this.autoAdvanceTimer&&this.autoAdvanceTimer.remove(),this.transitionToNextScene())})}applyChoiceEffects(t){if(!this.eventData)return;let e=this.eventData.returnData;for(let y of t){var s,i,a,r,n,l,o,c,h,d,u,p,f,g,m;switch(y.type){case"heal":if("player"===y.target&&"HP"===y.stat){let t=null!=(r=null!=(a=null==(s=e.player)?void 0:s.maxHP)?a:null==(i=e.player)?void 0:i.HP)?r:100,o=Math.floor(t*(y.value/100));e.player&&(e.player.currentHP=Math.min(t,(null!=(l=null!=(n=e.player.currentHP)?n:e.player.HP)?l:t)+o))}break;case"damage":if("player"===y.target&&"HP"===y.stat){let t=null!=(d=null!=(h=null==(o=e.player)?void 0:o.maxHP)?h:null==(c=e.player)?void 0:c.HP)?d:100,s=Math.floor(t*(y.value/100));e.player&&(e.player.currentHP=Math.max(1,(null!=(p=null!=(u=e.player.currentHP)?u:e.player.HP)?p:t)-s))}break;case"techDebt":void 0!==e.techDebtCarry?e.techDebtCarry+=y.value:e.techDebtCarry=y.value;break;case"gold":y.multiplier?e.goldMultiplier=y.value:e.player&&(e.player.gold=(null!=(f=e.player.gold)?f:0)+y.value);break;case"exp":e.player&&(e.player.exp=(null!=(g=e.player.exp)?g:0)+y.value);break;case"buff":case"debuff":e.eventEffects||(e.eventEffects=[]),e.eventEffects.push({stat:y.stat,modifier:"buff"===y.type?y.value:-y.value,duration:null!=(m=y.duration)?m:3,type:y.type})}}}showAutoResolve(t,e,s){var i,a;let r=this.getEffectColor(t);this.time.delayedCall(900,()=>{this.applyEffectAnimation(r,this.isPositiveEvent(t))});let n=this.add.text(e,s+100,t.resultText,{fontSize:"24px",fontFamily:"Arial",color:"#".concat(r.toString(16).padStart(6,"0")),fontStyle:"bold",align:"center",wordWrap:{width:600}});n.setOrigin(.5),n.setAlpha(0),this.tweens.add({targets:n,alpha:1,scale:{from:1.2,to:1},duration:500,delay:1200,ease:"Back.easeOut"});let l=this.add.text(e,s+180,"Click to Continue",{fontSize:"18px",fontFamily:"Arial",color:"#".concat(this.COLOR_BLUE.toString(16).padStart(6,"0")),fontStyle:"italic"});l.setOrigin(.5),l.setAlpha(0),this.tweens.add({targets:l,alpha:1,duration:300,delay:1700,onComplete:()=>{this.canSkip=!0}}),this.tweens.add({targets:l,alpha:.5,duration:800,delay:2e3,yoyo:!0,repeat:-1}),this.autoAdvanceTimer=this.time.delayedCall(5e3,()=>{this.transitionToNextScene()}),this.input.on("pointerdown",()=>{this.canSkip&&(this.autoAdvanceTimer&&this.autoAdvanceTimer.remove(),this.transitionToNextScene())}),null==(i=this.input.keyboard)||i.on("keydown-SPACE",()=>{this.canSkip&&(this.autoAdvanceTimer&&this.autoAdvanceTimer.remove(),this.transitionToNextScene())}),null==(a=this.input.keyboard)||a.on("keydown-ENTER",()=>{this.canSkip&&(this.autoAdvanceTimer&&this.autoAdvanceTimer.remove(),this.transitionToNextScene())})}applyEffectAnimation(t,e){let s=this.cameras.main.width/2,i=this.cameras.main.height/2,a=this.add.rectangle(s,i,this.cameras.main.width,this.cameras.main.height,t,.6);a.setDepth(100),this.tweens.add({targets:a,alpha:0,duration:600,ease:"Power2",onComplete:()=>a.destroy()}),e&&this.createParticles(s,i,t)}createParticles(t,e,s){for(let i=0;i<12;i++){let a=i/12*Math.PI*2,r=this.add.circle(t,e,4,s);this.tweens.add({targets:r,x:t+100*Math.cos(a),y:e+100*Math.sin(a),alpha:0,duration:800,ease:"Power2",onComplete:()=>r.destroy()})}}getEffectColor(t){let e=t.effects.map(t=>t.type);return e.includes("buff")||e.includes("heal")?this.COLOR_GREEN:e.includes("debuff")||e.includes("damage")?this.COLOR_RED:e.includes("gold")?this.COLOR_YELLOW:e.includes("techDebt")?this.COLOR_PURPLE:this.COLOR_BLUE}getChoiceEffectColor(t){let e=t.effects.map(t=>t.type);if(e.includes("exp")||e.includes("heal")||e.includes("buff"))return this.COLOR_GREEN;if(e.includes("gold"))return this.COLOR_YELLOW;if(e.includes("damage")||e.includes("debuff"))return this.COLOR_RED;if(e.includes("techDebt")){let e=t.effects.find(t=>"techDebt"===t.type);return e&&e.value<0?this.COLOR_GREEN:this.COLOR_PURPLE}return this.COLOR_BLUE}isPositiveEvent(t){let e=t.effects.map(t=>t.type);return e.includes("buff")||e.includes("heal")||e.includes("gold")}isPositiveChoice(t){let e=t.effects.map(t=>t.type);if(e.includes("heal")||e.includes("buff")||e.includes("exp")||e.includes("gold"))return!0;if(e.includes("techDebt")){let e=t.effects.find(t=>"techDebt"===t.type);if(e&&e.value<0)return!0}return!1}transitionToNextScene(){if(!this.eventData)return;let{returnScene:t,returnData:e}=this.eventData;this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start(t,e)})}shutdown(){var t,e,s,i,a,r,n,l;this.autoAdvanceTimer&&this.autoAdvanceTimer.remove(),null==(t=this.input.keyboard)||t.off("keydown-SPACE"),null==(e=this.input.keyboard)||e.off("keydown-ENTER"),null==(s=this.input.keyboard)||s.off("keydown-1"),null==(i=this.input.keyboard)||i.off("keydown-2"),null==(a=this.input.keyboard)||a.off("keydown-3"),null==(r=this.input.keyboard)||r.off("keydown-A"),null==(n=this.input.keyboard)||n.off("keydown-B"),null==(l=this.input.keyboard)||l.off("keydown-C"),this.input.off("pointerdown")}constructor(){super({key:"EventScene"}),this.canSkip=!1,this.choiceMade=!1,this.COLOR_BG=1973790,this.COLOR_YELLOW=0xdcdcaa,this.COLOR_WHITE=0xffffff,this.COLOR_BLUE=4886754,this.COLOR_GREEN=5163440,this.COLOR_RED=0xf48771,this.COLOR_PURPLE=0xc586c0,this.COLOR_PANEL=2434342,this.COLOR_HOVER=2764078,this.COLOR_BORDER=3947580}}class R{static getStatusPair(t){var e;return null!=(e=({HP:{color:"#4ec9b0",icon:"❤",shape:"heart",label:"Health Points"},MP:{color:"#569cd6",icon:"◆",shape:"diamond",label:"Magic Points"},ATK:{color:"#f48771",icon:"⚔",shape:"upTriangle",label:"Attack"},DEF:{color:"#dcdcaa",icon:"\uD83D\uDEE1",shape:"square",label:"Defense"},SPD:{color:"#9cdcfe",icon:"⚡",shape:"bolt",label:"Speed"}})[t])?e:{color:"#d4d4d4",icon:"?",label:t}}static getRarityPair(t){var e;let s={common:{color:"#d4d4d4",icon:"○",shape:"circle",label:"Common"},rare:{color:"#569cd6",icon:"★",shape:"star",label:"Rare"},epic:{color:"#c586c0",icon:"♔",shape:"crown",label:"Epic"}};return null!=(e=s[t])?e:s.common}static getTechDebtPair(t){var e;let s={low:{color:"#89d185",icon:"✓",shape:"checkmark",label:"Low Tech Debt"},medium:{color:"#cca700",icon:"⚠",shape:"warning",label:"Medium Tech Debt"},high:{color:"#ce9178",icon:"!",shape:"exclamation",label:"High Tech Debt"},critical:{color:"#f48771",icon:"☠",shape:"skull",label:"Critical Tech Debt"}};return null!=(e=s[t])?e:s.medium}static getCombatActionPair(t){var e;return null!=(e=({attack:{color:"#f48771",icon:"⚔",shape:"sword",label:"Attack"},skill:{color:"#569cd6",icon:"⭐",shape:"star",label:"Skill"},focus:{color:"#dcdcaa",icon:"\uD83D\uDEE1",shape:"shield",label:"Focus"},item:{color:"#4ec9b0",icon:"\uD83E\uDDED",shape:"compass",label:"Item"},flee:{color:"#858585",icon:"\uD83C\uDFC3",shape:"run",label:"Flee"}})[t])?e:{color:"#d4d4d4",icon:"?",label:t}}static getStageStatusPair(t){var e;let s={completed:{color:"#4ec9b0",icon:"✓",shape:"checkmark",label:"Completed"},current:{color:"#dcdcaa",icon:"▶",shape:"arrow",label:"Current"},locked:{color:"#858585",icon:"\uD83D\uDD12",shape:"lock",label:"Locked"}};return null!=(e=s[t])?e:s.locked}static getRelativeLuminance(t){let e=t.replace("#",""),s=parseInt(e.substring(0,2),16)/255,i=parseInt(e.substring(2,4),16)/255,a=parseInt(e.substring(4,6),16)/255;return .2126*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))+.7152*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))+.0722*(a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4))}static contrastRatio(t,e){let s=this.getRelativeLuminance(t),i=this.getRelativeLuminance(e);return(Math.max(s,i)+.05)/(Math.min(s,i)+.05)}static getAccessibleTextColor(t){return this.contrastRatio("#ffffff",t)>this.contrastRatio("#000000",t)?"#ffffff":"#000000"}static simulateColorBlindness(t,e){let s,i,a;if("none"===e)return t;let r=t.replace("#",""),n=parseInt(r.substring(0,2),16)/255,l=parseInt(r.substring(2,4),16)/255,o=parseInt(r.substring(4,6),16)/255;switch(e){case"protanopia":s=.567*n+.433*l,i=.558*n+.442*l,a=.242*l+.758*o;break;case"deuteranopia":s=.625*n+.375*l,i=.7*n+.3*l,a=.3*l+.7*o;break;case"tritanopia":s=.95*n+.05*l,i=.433*l+.567*o,a=.475*l+.525*o;break;default:return t}s=Math.max(0,Math.min(1,s)),i=Math.max(0,Math.min(1,i)),a=Math.max(0,Math.min(1,a));let c=Math.round(255*s).toString(16).padStart(2,"0"),h=Math.round(255*i).toString(16).padStart(2,"0"),d=Math.round(255*a).toString(16).padStart(2,"0");return"#".concat(c).concat(h).concat(d)}static validatePalette(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#1e1e1e";var s=this;let i=[],a=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";for(let[n,l]of Object.entries(t)){let t=r?"".concat(r,".").concat(n):n;if("string"==typeof l&&l.startsWith("#")){let a,r=s.contrastRatio(l,e),n=r>=s.WCAG_AA_NORMAL,o=r>=s.WCAG_AA_LARGE;n||(a=o?"Use for large text (18pt+) or UI components only":"Increase contrast or use with icon pairing"),i.push({color:l,name:t,contrastRatio:Math.round(100*r)/100,passesAA:n,passesAALarge:o,suggestion:a})}else"object"==typeof l&&null!==l&&a(l,t)}};return a(t),{passed:i.every(t=>t.passesAALarge),results:i}}setConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}applyColorBlindFilter(t){return R.simulateColorBlindness(t,this.config.colorBlindMode)}getTextScale(){return this.config.textScale}isIconPairingEnabled(){return this.config.iconPairing}isHighContrastEnabled(){return this.config.highContrast}constructor(t={}){var e,s,i,a;this.config={highContrast:null!=(e=t.highContrast)&&e,colorBlindMode:null!=(s=t.colorBlindMode)?s:"none",iconPairing:null==(i=t.iconPairing)||i,textScale:null!=(a=t.textScale)?a:1},this.pairs=new Map}}R.WCAG_AA_NORMAL=4.5,R.WCAG_AA_LARGE=3;var L=s(7961);let F=0,z={playerName:"Hero",playerHP:100,playerMaxHP:100,playerMP:50,playerMaxMP:50,playerLevel:1,playerExp:0,playerExpNext:100,monsterName:"",monsterHP:0,monsterMaxHP:0,monsterType:"bug",bossPhase:1,skills:[],techDebt:0,statusEffects:[],logs:[],isPlayerTurn:!0,isBattleActive:!1,chapter:1,stage:1},N=(0,L.vt)(t=>({...z,updatePlayer:e=>t(t=>({...t,...e})),updateMonster:e=>t(t=>({...t,...e})),setSkills:e=>t({skills:e}),setTechDebt:e=>t({techDebt:e}),setStatusEffects:e=>t({statusEffects:e}),addLog:(e,s)=>t(t=>({logs:[...t.logs.slice(-49),{id:++F,message:e,type:s}]})),clearLogs:()=>t({logs:[]}),setTurn:e=>t({isPlayerTurn:e}),setBattleActive:e=>t({isBattleActive:e}),setStageInfo:(e,s)=>t({chapter:e,stage:s}),reset:()=>{F=0,t(z)}})),U={panel:"#252526",border:"#3c3c3c",blue:"#4a90e2",red:"#ef4444",green:"#4ade80",yellow:"#dcdcaa",purple:"#c586c0",dimText:"#858585"};function j(t){let{current:e,max:s,color:a,label:r,showText:n=!0}=t,l=s>0?Math.max(0,Math.min(100,e/s*100)):0;return(0,i.jsxs)("div",{style:{marginBottom:4},children:[n&&(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:U.dimText,marginBottom:2},children:[(0,i.jsx)("span",{children:r}),(0,i.jsxs)("span",{children:[e,"/",s]})]}),(0,i.jsx)("div",{style:{height:8,backgroundColor:"#2a2a2a",borderRadius:4,overflow:"hidden"},children:(0,i.jsx)("div",{style:{height:"100%",width:"".concat(l,"%"),backgroundColor:a,borderRadius:4,transition:"width 0.3s ease"}})})]})}function _(){let{playerName:t,playerHP:e,playerMaxHP:s,playerMP:a,playerMaxMP:r,playerLevel:n,playerExp:l,playerExpNext:o,monsterName:c,monsterHP:h,monsterMaxHP:d,monsterType:u,bossPhase:p,statusEffects:f,isBattleActive:g}=N();if(!g)return null;let m=f.filter(t=>"player"===t.target),y=f.filter(t=>"monster"===t.target);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{position:"absolute",top:8,left:8,width:200,padding:"8px 10px",backgroundColor:U.panel,border:"1px solid ".concat(U.border),borderRadius:6,opacity:.92},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[(0,i.jsx)("span",{style:{fontSize:13,fontWeight:"bold",color:U.blue},children:t}),(0,i.jsxs)("span",{style:{fontSize:11,color:U.dimText},children:["Lv.",n]})]}),(0,i.jsx)(j,{current:e,max:s,color:U.green,label:"HP"}),(0,i.jsx)(j,{current:a,max:r,color:U.blue,label:"MP"}),(0,i.jsx)(j,{current:l,max:o,color:U.yellow,label:"EXP"}),m.length>0&&(0,i.jsx)("div",{style:{fontSize:10,color:U.purple,marginTop:4},children:m.map((t,e)=>(0,i.jsxs)("span",{style:{marginRight:6},children:["stun"===t.type?"⚡":"❓"," ",t.type.toUpperCase()," (",t.turnsRemaining,"t)"]},e))})]}),(0,i.jsxs)("div",{style:{position:"absolute",top:8,right:8,width:200,padding:"8px 10px",backgroundColor:U.panel,border:"1px solid ".concat(U.border),borderRadius:6,opacity:.92},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[(0,i.jsx)("span",{style:{fontSize:13,fontWeight:"bold",color:U.red},children:c}),"boss"===u&&(0,i.jsxs)("span",{style:{fontSize:10,color:U.yellow},children:["P",p]})]}),(0,i.jsx)(j,{current:h,max:d,color:U.red,label:"HP"}),y.length>0&&(0,i.jsx)("div",{style:{fontSize:10,color:U.purple,marginTop:4},children:y.map((t,e)=>(0,i.jsxs)("span",{style:{marginRight:6},children:["stun"===t.type?"⚡":"❓"," ",t.type.toUpperCase()," (",t.turnsRemaining,"t)"]},e))})]})]})}let G={panel:"#252526",border:"#3c3c3c",blue:"#4a90e2",dimText:"#858585",text:"#d4d4d4",disabled:"#4a4a4a",cooldown:"#f59e0b"};function K(){let{skills:t,playerMP:e,isPlayerTurn:s,isBattleActive:a}=N();return a&&0!==t.length?(0,i.jsx)("div",{style:{position:"absolute",bottom:8,left:8,right:8,maxWidth:500,margin:"0 auto",padding:"6px 8px",backgroundColor:G.panel,border:"1px solid ".concat(G.border),borderRadius:6,opacity:.92,display:"flex",flexWrap:"wrap",gap:4,justifyContent:"center"},children:t.map(t=>{let a=e>=t.mpCost,r=t.cooldown>0,n=s&&a&&!r;return(0,i.jsxs)("button",{disabled:!n,title:t.description,onClick:()=>{n&&window.dispatchEvent(new CustomEvent("battle:action",{detail:{type:"skill",skillId:t.id}}))},style:{padding:"4px 8px",fontSize:11,borderRadius:4,border:"1px solid ".concat(n?G.blue:G.disabled),backgroundColor:n?"#2a4a6a":"#1a1a2a",color:n?G.text:G.dimText,cursor:n?"pointer":"default",opacity:n?1:.6,position:"relative",minWidth:80,textAlign:"center"},children:[(0,i.jsx)("div",{style:{fontWeight:"bold"},children:t.name}),(0,i.jsxs)("div",{style:{fontSize:10,color:G.dimText},children:[t.mpCost," MP",r&&(0,i.jsxs)("span",{style:{color:G.cooldown,marginLeft:4},children:["CD:",t.cooldown]})]}),r&&(0,i.jsx)("div",{style:{position:"absolute",inset:0,backgroundColor:"rgba(0,0,0,0.4)",borderRadius:4,display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:"bold",color:G.cooldown},children:t.cooldown})]},t.id)})}):null}let V={panel:"#252526",border:"#3c3c3c",blue:"#4a90e2",red:"#ef4444",green:"#4ade80",dimText:"#858585",text:"#d4d4d4"},W={player:V.green,enemy:V.red,system:V.blue};function q(){let{logs:t,isBattleActive:e}=N(),s=(0,a.useRef)(null);return((0,a.useEffect)(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[t]),e)?(0,i.jsxs)("div",{style:{position:"absolute",bottom:52,right:8,width:220,maxHeight:160,padding:"6px 8px",backgroundColor:V.panel,border:"1px solid ".concat(V.border),borderRadius:6,opacity:.88,display:"flex",flexDirection:"column"},children:[(0,i.jsx)("div",{style:{fontSize:11,color:V.dimText,marginBottom:4,fontWeight:"bold"},children:"Battle Log"}),(0,i.jsxs)("div",{ref:s,style:{flex:1,overflowY:"auto",fontSize:10,lineHeight:"14px",scrollbarWidth:"thin",scrollbarColor:"".concat(V.border," transparent")},children:[0===t.length&&(0,i.jsx)("div",{style:{color:V.dimText,fontStyle:"italic"},children:"Battle started..."}),t.map(t=>(0,i.jsxs)("div",{style:{color:W[t.type]||V.text,marginBottom:2},children:[(0,i.jsx)("span",{style:{color:V.dimText,marginRight:4},children:"player"===t.type?">":"enemy"===t.type?"!":"*"}),t.message]},t.id))]})]}):null}let Y={panel:"#252526",border:"#3c3c3c",green:"#4ade80",yellow:"#dcdcaa",orange:"#f59e0b",red:"#ef4444",dimText:"#858585"};function X(){let{techDebt:t,isBattleActive:e,chapter:s,stage:a}=N();if(!e)return null;let r=t<30?Y.green:t<60?Y.yellow:t<80?Y.orange:Y.red,n=t<30?"Low":t<60?"Medium":t<80?"High":"Critical",l=Math.min(100,t);return(0,i.jsxs)("div",{style:{position:"absolute",bottom:52,left:8,width:180,padding:"6px 8px",backgroundColor:Y.panel,border:"1px solid ".concat(Y.border),borderRadius:6,opacity:.92},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,marginBottom:4},children:[(0,i.jsx)("span",{style:{color:Y.dimText,fontWeight:"bold"},children:"Tech Debt"}),(0,i.jsxs)("span",{style:{color:Y.dimText,fontSize:10},children:["Ch.",s," S.",a]})]}),(0,i.jsx)("div",{style:{height:10,backgroundColor:"#2a2a2a",borderRadius:5,overflow:"hidden",marginBottom:4},children:(0,i.jsx)("div",{style:{height:"100%",width:"".concat(l,"%"),backgroundColor:r,borderRadius:5,transition:"width 0.3s ease, background-color 0.3s ease"}})}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:10},children:[(0,i.jsx)("span",{style:{color:r,fontWeight:"bold"},children:n}),(0,i.jsxs)("span",{style:{color:Y.dimText},children:[t,"/100"]})]})]})}function J(){return(0,i.jsxs)("div",{style:{position:"absolute",inset:0,pointerEvents:"none",zIndex:10,fontFamily:"'Segoe UI', 'Consolas', monospace",color:"#d4d4d4"},children:[(0,i.jsx)("div",{style:{pointerEvents:"auto"},children:(0,i.jsx)(_,{})}),(0,i.jsx)("div",{style:{pointerEvents:"auto"},children:(0,i.jsx)(X,{})}),(0,i.jsx)("div",{style:{pointerEvents:"auto"},children:(0,i.jsx)(q,{})}),(0,i.jsx)("div",{style:{pointerEvents:"auto"},children:(0,i.jsx)(K,{})})]})}function Q(t){let{className:e}=t,s=(0,a.useRef)(null),r=(0,a.useRef)(null);return(0,a.useEffect)(()=>{!s.current&&r.current&&(s.current=function(t){let e={type:n().AUTO,width:800,height:600,parent:t,backgroundColor:"#1e1e1e",scene:[c,d,S,v,w,I,H,D,B],physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scale:{mode:n().Scale.FIT,autoCenter:n().Scale.CENTER_BOTH},input:{activePointers:3,touch:{target:null}}};return new(n()).Game(e)}("phaser-game"));let t=function(){let t=t=>{if(!(t instanceof CustomEvent)||!t.detail||"object"!=typeof t.detail)return;let e=t.detail,s=N.getState();e.player&&"object"==typeof e.player&&s.updatePlayer(e.player),e.monster&&"object"==typeof e.monster&&s.updateMonster(e.monster),e.skills&&Array.isArray(e.skills)&&s.setSkills(e.skills),"number"==typeof e.techDebt&&s.setTechDebt(e.techDebt),e.statusEffects&&Array.isArray(e.statusEffects)&&s.setStatusEffects(e.statusEffects),e.log&&"string"==typeof e.log.message&&"string"==typeof e.log.type&&s.addLog(e.log.message,e.log.type),"boolean"==typeof e.isPlayerTurn&&s.setTurn(e.isPlayerTurn),"boolean"==typeof e.battleActive&&s.setBattleActive(e.battleActive),e.stage&&"number"==typeof e.stage.chapter&&"number"==typeof e.stage.stage&&s.setStageInfo(e.stage.chapter,e.stage.stage)};return window.addEventListener("battle:update",t),()=>window.removeEventListener("battle:update",t)}();return()=>{t(),s.current&&(s.current.destroy(!0),s.current=null)}},[]),(0,i.jsxs)("div",{className:e,style:{position:"relative"},children:[(0,i.jsx)("div",{id:"phaser-game",ref:r,className:"w-full h-full flex items-center justify-center"}),(0,i.jsx)(J,{})]})}}}]);